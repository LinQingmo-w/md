## 多线程相关内容

任务：同步任务(sync)、异步任务(async)

队列：串形队列(serial)、并发队列(concurrent)



![image-20191217230059013](https://tva1.sinaimg.cn/large/006tNbRwly1ga046x4x37j314s0dcaco.jpg)

同步并发队列：还是串行执行任务

同步串形队列：串形执行任务

异步串行：开启一个新线程，串形

异步并发队列：开启新线程，

主队列异步：没有开启新线程，串形。

**死锁**

注意：syn + 主队列：死锁

串形队列中执行同步任务容易死锁

serialQueue.async {

​	2

​	serialQueue.sync{

​		3

​	}

​	4

}

> serialQueue ，先进的2，因为是同步线程，所以先走2.
>
> 2是异步执行的时候进3，等3完成才走4，4完成2的全部事件才完成
>
> 但是同步队列，前一个没完成，后面一个不能进行，而前一个又等着3完成才走4 。所以死锁

## A事件完成后再进行B事件，多线程怎么处理

1. 

同步并发队列：concurrentQueue.sync

同步串形队列: serialQueue.sync

异步串形队列：serialQueue.async



2. serialQueue:

	(1). 

serialQueue.sync{1}

serialQueue.sync{2}/serialQueue.async{2}



​	(2). 

serialQueue.sync{

​	1

​	serialQueue.async{2}

}



​	(3). 

concurrentQueue.sync{1}

concurrentQueue.sync{2}/async{2}



​	(4).

concurrentQueue.async{

​	1

​	concurrentQueue.sync{2}

}



3. 分组，

	dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);

	dispatch_group_t group = dispatch_group_create();

	dispatch_group_aysnc(group,queue ^{1});

	dispatch_group_notify(group,dispatch_ger_main_queue(),^{ 2 });

4. 栅栏，

	dispatch_async(queue,^{1});

	dispatch_barrier_aysnc(queue,^{ wait });

	dispatch_async(queue,^{2});

5. 信号量

	

## 多线程会遇到的问题

1. 竞态：同时读写
2. 优先级倒置：
3. 死锁：相互依赖



## dispatch

dispatch_queue_t  //队列

dispatch_async(queue,^{}); //异步,不等结果返回就走下一步

dispatch_sync(queue,^{}); //同步，等执行完才走下一步

dispatch_set_target_queue(queue1,queue2);//队列-指定 1 的属性 为 2（属性：优先级，并/串形）

dispatch_after(time,queue,^{});//延迟执行，注意是到时间放到队列里，不是立即执行，会有时间偏差

disspatch_group_t //分组，可得到分组结果，具体如上面

dispatch_barrier_async(queue,^{});//栅栏，等栅栏上面的异步都执行完了，再执行栅栏，再执行栅栏下面的。

dispatch_apply(count,queue,^(index){});//重复添加几个

dispatch_suspend(queue);//线程挂起，暂停

dispatch_resume(queue);//线程恢复，继续

dispatch_semaphore_t  semaphore;//信号量 变量 为0时等待，为1或大于1，则减1而不等待

dispatch_semaphore_wait(semaphore,time);//等待信号量触发，等待时常   为0时等待，为1或大于1，则减1而不等待 ，就是wait执行减1操作

dispatch_semaphore_signal(semaphore);//数值加1

static dispatch_once_t pred;

dispatch_once(&pred,^{});//单例

dispatch_io/dispatch_data;//分段处理io和数据。