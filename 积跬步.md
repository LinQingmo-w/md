# é—®é¢˜è®°å½•

-----
#### <font color=red>å›¾ç‰‡é®ç½©ä¸å…¨</font>

![å±å¹•å¿«ç…§ 2019-03-13 ä¸‹åˆ12.03.49](https://ws4.sinaimg.cn/large/006tKfTcly1g111bbg2v9j30ty0d814p.jpg "é—®é¢˜å›¾ç‰‡")

   1. **èƒŒæ™¯ï¼š**å®¢æˆ·ç«¯ä¸Šä¼ å›¾ç‰‡ï¼Œåœ¨plusä¸Šï¼Œä¸Šä¼ è®°å½•è’™ç‰ˆå±•ç¤ºä¸å…¨ï¼Œåº”è¯¥æ˜¯ä½ç½®é—®é¢˜

   2. **å®ç°åŸç†ï¼š**

      * æ§ä»¶æ•´ä¸ªæ˜¯ä¸ª`collectionView`ï¼Œ`cell`é‡Œé¢æœ‰ä¸ª`imageView`,è’™ç‰ˆé‡‡ç”¨`category`,å°è£…ä¸º`UIImageView`çš„ä¸€ä¸ªåˆ†ç±»ï¼Œæä¾›ä¸€ä¸ª`progerss`å±æ€§ï¼ŒåŠ è½½å›¾ç‰‡æ—¶ï¼ŒåŠ è½½è¿›åº¦ä¼ å€¼ç»™`progerss`ï¼Œ`progress`æ ¹æ®å€¼å¤§å°æ§åˆ¶è’™ç‰ˆè¿›åº¦å’Œæ˜¯å¦æ˜¾ç¤ºã€‚

      * è®¾ç½®`progress`çš„æ—¶å€™ï¼Œè’™ç‰ˆå¤§å°é‡‡ç”¨`imageView`çš„`bounds`å€¼ï¼Œä½œä¸ºå¤§å°ã€‚

        ``` objective-c
        #import "UIImageView+Common.h"
        @implementation ImageLoadingView
        - (instancetype)initWithFrame:(CGRect)frame
        {
            self = [super initWithFrame:frame];
            if (self) {
                [self addSubview:self.opacityMask];
                [self.opacityMask addSubview:self.progressLabel];
                [self.opacityMask.layer insertSublayer:self.maskLayerUp atIndex:0];
            }
            return self;
        }
        - (UIView*)opacityMask
        {
            if (!_opacityMask) {
                _opacityMask = [[UIView alloc]initWithFrame:self.bounds];
                _opacityMask.backgroundColor = [kColorT_White colorWithAlphaComponent:.5];
            }
            return _opacityMask;
        }
        - (UILabel*)progressLabel
        {
            if (!_progressLabel) {
                _progressLabel = ({
                    UILabel *label = [[UILabel alloc]initWithFrame:self.bounds];
                    label.textAlignment = NSTextAlignmentCenter;
                    label.textColor = kColorR_111;
                    label.font = kFont7_10;
                    label.numberOfLines = 0;
                    label.text = @"å›¾ç‰‡ä¸Šä¼ ä¸­";
                    label;
                });
            }
            return _progressLabel;
        }
        - (CAShapeLayer*)maskLayerUp{
            if (!_maskLayerUp) {
                _maskLayerUp = [CAShapeLayer layer];
                _maskLayerUp.bounds = self.bounds;
                _maskLayerUp.fillColor = [kColorK_Pink colorWithAlphaComponent:.94].CGColor; // Any color but clear will be OK
                _maskLayerUp.path = [UIBezierPath bezierPathWithRect:CGRectMake(0, 0,  self.bounds.size.width, self.bounds.size.height)].CGPath;
                _maskLayerUp.opacity = 0.8f;
                _maskLayerUp.anchorPoint = CGPointMake(0, 0);
            }
            return _maskLayerUp;
        }
        - (void)setProgress:(float)progress{
            _progress = (1.0-progress);
             self.maskLayerUp.path = [UIBezierPath bezierPathWithRect:CGRectMake(0, self.opacityMask.frame.size.height*progress,  self.opacityMask.frame.size.width, self.opacityMask.frame.size.height*(1-progress))].CGPath;
            self.progressLabel.text = [NSString stringWithFormat:@"å›¾ç‰‡ä¸Šä¼ ä¸­%d%%",(int)((progress)*100)];
            
        }
        @end
        
        @implementation UIImageView (Common)
            - (void)setProgress:(NSNumber*)progress
        {
            objc_setAssociatedObject(self, @selector(progress), progress, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
            if (self.showProgress.boolValue) {
                self.loadingView.progress = self.progress.floatValue;
            }
        }
        - (void)setShowProgress:(NSNumber *)showProgress
        {
            objc_setAssociatedObject(self, @selector(showProgress), showProgress, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
            //åˆ¤æ–­æ˜¯å¦å±•ç¤ºè¿›åº¦æ¡
            if (self.showProgress.boolValue) {
                if (self.image.progressStatus.integerValue!=2) {
                    if (!self.loadingView.superview) {
                        //Xç³»åˆ—å¤§å°ä¸å‡†ç¡®ï¼Ÿ
        //                CGRect rect = CGRectMake(0, 0, (kScreen_Width-34)/5-6, (kScreen_Width-34)/5-6);
                        self.loadingView = [[ImageLoadingView alloc]initWithFrame:self.bounds];
                        [self addSubview:self.loadingView];
                    }
                    if (self.image.progressStatus.integerValue==3) {
                        self.loadingView.progressLabel.text = @"ä¸Šä¼ å¤±è´¥";
                    }
                }
            }else
            {
                if (self.loadingView&&self.loadingView.superview) {
                    [self.loadingView.subviews makeObjectsPerformSelector:@selector(removeFromSuperview)];
                    [self.loadingView removeFromSuperview];
                    self.loadingView = nil;
                }
            }
          
        }
        - (void)setUploadImage:(UIImage *)image WithProgressHandler:(void(^)(float percent))progress withSuccess:(void(^)(NSString *imagekey))successHander;
        {
            if (!image||!self.showProgress) {
                return;
            }
            //1.è®¾ç½®å›¾ç‰‡
            self.image = image;
            
            //2.è·å–token
            if (self.uploadToken) {
                //ä¸Šä¼ 
                if (self.image.progressStatus.integerValue!=2) {
                   [self uploadImageWithProgressHandler:progress withSuccess:successHander];
                }else{
                    self.showProgress = @0;
                }
                
            }else
            {
                if (self.image.progressStatus.integerValue!=2) {
                    [self startUpLoadSuccess:^(NSString *token) {
                        self.uploadToken = token;
                        //ä¸Šä¼ 
                        [self uploadImageWithProgressHandler:progress withSuccess:successHander];
                    } failed:^{
                        //è·å–tokenå¤±è´¥
                    }];
                }else
                {
                    self.showProgress = @0;
                }
            }
        }
        //categoryçš„å…¶ä»–åŠŸèƒ½ï¼ŒåŠæ·»åŠ å±æ€§çš„set getæ–¹æ³•å·²çœç•¥
        ```

        

      * `collectionViewCell`å¤§å°æ˜¯æ ¹æ®é¡µé¢å®½åº¦è®¡ç®—çš„,ä¸åŒå±å¹•å®½åº¦å›¾ç‰‡å¤§å°ä¸åŒã€‚

      * å›¾ç‰‡åŠ è½½æ—¶ï¼Œpluså®½åº¦å˜å¤§ï¼Œè€Œå› ä¸ºåé¢çš„cellæ˜¯ç¬¬ä¸€æ¬¡åŠ è½½ï¼Œå–åˆ°çš„boundså€¼ä¸å¯¹ï¼ˆåº”è¯¥æ˜¯70ï¼Œæ˜¾ç¤º64ï¼‰ï¼Œæ‰€ä»¥æ˜¾ç¤ºå‡ºé”™ã€‚

   3. **äº§ç”ŸåŸå› ï¼š**

      1. <font color=red>ä¿®æ”¹bounds </font>  ä»¥ä¸ºå¤§å°ä¸å¯¹ï¼Œæ˜¯åº”ä¸ºå¾ªç¯åº”ç”¨ç­‰åŸå› ï¼Œé€ æˆçš„å¤§å°æœªæ›´æ–°ã€‚é€šè¿‡æ‰“å°æ•°æ®å¾—çŸ¥ï¼Œè®¾ç½®å›¾ç‰‡å¤§å°åœ¨`cell`çš„`layoutSubView`ä¹‹å‰,æ‰€ä»¥ä¸æ˜¯å¤§å°çš„é—®é¢˜ã€‚
      2. <font color=blue>å›¾ç‰‡å¤§å°æœªæ›´æ–°</font>   `collectionViewCell`åœ¨è®¾ç½®å›¾ç‰‡çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰åœ¨é¡µé¢ä¸Šå±•ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥å¤§å°ä¸å¯¹ã€‚åœ¨å¤ç”¨çš„æ—¶å€™ï¼Œå¤§å°å°±æ˜¯å¯¹äº†çš„ã€‚

4. **è§£å†³åŠæ³•ï¼š**

   â€‹	åŸæ¥è®¾ç½®äº† `setNeedsLayout` åœ¨cellæœ€åï¼Œä½†æ˜¯æ²¡ç”¨ã€‚

   â€‹	åœ¨è®¾ç½®`cell` çš„ `image`ä¹‹å‰ï¼Œå…ˆè°ƒç”¨ `[cell layoutIfNeeded];`  [é“¾æ¥](https://segmentfault.com/q/1010000002732923?_ea=193700) 

   â€‹	æµ‹è¯•äº†æŠŠ `setNeedsLayout` ç§»åˆ°å‰é¢ ï¼Œä¸èƒ½è§£å†³é—®é¢˜ã€‚æœ‰äº†`layoutIfNeeded` ï¼Œ `setNeedsLayout` æœ‰æ²¡æœ‰æ²¡ä»€ä¹ˆå½±å“

   ```objective-c
   -(UICollectionViewCell *)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath
   {
    DisplayImageCell *cell = [collectionView dequeueReusableCellWithReuseIdentifier:@"DisplayImageCell" forIndexPath:indexPath];
   //     [cell setNeedsLayout];
    [cell layoutIfNeeded];
    ...... 
        è®¾ç½®cellå†…å®¹
    Â·Â·Â·Â·Â·Â·
    //[cell setNeedsLayout];
    return cell;  
   }
   ```


5. **ç›¸å…³å†…å®¹ï¼š**

   â€‹	/æ¥è‡ªè‹¹æœapiçš„ç¿»è¯‘/

   â€‹	`setNeedsLayout`:å½“éœ€è¦è°ƒæ•´è§†å›¾å­è§†å›¾çš„å¸ƒå±€æ—¶ï¼Œåœ¨åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸Šè°ƒç”¨æ­¤æ–¹æ³•ã€‚æ­¤æ–¹æ³•è®°å½•è¯·æ±‚å¹¶ç«‹å³è¿”å›ã€‚ç”±äºæ­¤æ–¹æ³•**ä¸å¼ºåˆ¶ç«‹å³æ›´æ–°**ï¼Œè€Œæ˜¯**ç­‰å¾…ä¸‹ä¸€ä¸ªæ›´æ–°å‘¨æœŸ**ï¼Œå› æ­¤å¯ä»¥åœ¨æ›´æ–°ä»»ä½•è§†å›¾ä¹‹å‰ä½¿ç”¨å®ƒæ¥ä½¿å¤šä¸ªè§†å›¾çš„å¸ƒå±€æ— æ•ˆã€‚æ­¤è¡Œä¸ºå…è®¸æ‚¨å°†æ‰€æœ‰å¸ƒå±€æ›´æ–°åˆå¹¶åˆ°ä¸€ä¸ªæ›´æ–°å‘¨æœŸï¼Œè¿™é€šå¸¸å¯¹æ€§èƒ½æ›´å¥½ã€‚

   â€‹	`layoutIfNeeded`  :ä½¿ç”¨æ­¤æ–¹æ³•**å¼ºåˆ¶è§†å›¾ç«‹å³æ›´æ–°å…¶å¸ƒå±€**ã€‚ä½¿ç”¨è‡ªåŠ¨å¸ƒå±€æ—¶ï¼Œå¸ƒå±€å¼•æ“ä¼šæ ¹æ®éœ€è¦æ›´æ–°è§†å›¾çš„ä½ç½®ï¼Œä»¥æ»¡è¶³çº¦æŸçš„æ›´æ”¹ã€‚ä½¿ç”¨æ¥æ”¶æ¶ˆæ¯çš„è§†å›¾ä½œä¸ºæ ¹è§†å›¾ï¼Œæ­¤æ–¹æ³•ä»æ ¹å¼€å§‹å¸ƒå±€è§†å›¾å­æ ‘ã€‚å¦‚æœæ²¡æœ‰æŒ‚èµ·çš„å¸ƒå±€æ›´æ–°ï¼Œåˆ™æ­¤æ–¹æ³•åœ¨ä¸ä¿®æ”¹å¸ƒå±€æˆ–è°ƒç”¨ä»»ä½•ä¸å¸ƒå±€ç›¸å…³çš„å›è°ƒçš„æƒ…å†µä¸‹é€€å‡ºã€‚

   â€‹	`layoutSubviews`ï¼šé»˜è®¤å®ç°äº†ä½¿ç”¨æ‚¨è®¾ç½®çš„ä»»ä½•çº¦æŸæ¥ç¡®å®šä»»ä½•å­è§†å›¾çš„å¤§å°å’Œä½ç½®ã€‚å¦‚æœè¦å¼ºåˆ¶å¸ƒå±€æ›´æ–°ï¼Œè¯·åœ¨**ä¸‹æ¬¡å›¾å½¢æ›´æ–°ä¹‹å‰è°ƒç”¨`setNeedsLayoutï¼ˆï¼‰`æ–¹æ³•**ã€‚å¦‚æœè¦**ç«‹å³æ›´æ–°è§†å›¾çš„å¸ƒå±€ï¼Œè¯·è°ƒç”¨`layoutIfneededï¼ˆï¼‰`æ–¹æ³•**ã€‚

-----

#### é¡µé¢æ»‘åŠ¨è¿”å›æ˜¾ç¤º

1. **èƒŒæ™¯ï¼š** å·¥ç¨‹å¸ˆç«¯ï¼Œå‘é€éœ€æ±‚æ¶ˆæ¯ï¼Œç‚¹å‡»å‘é€æ¶ˆæ¯è·³è½¬åˆ°èŠå¤©é¡µé¢ï¼Œåœ¨èŠå¤©é¡µæ»‘åŠ¨è¿”å›æ—¶ï¼Œæ»‘åˆ°ä¸€åŠæ”¾æ‰‹äº†ï¼Œå³æ²¡æœ‰è¿”å›é¡µé¢ã€‚ä½†æ˜¯ä¼šå‡ºæ¥ä¸€ä¸ªåŠ è½½æ¡†hubã€‚
2. **äº§ç”ŸåŸå› ï¼š**  ä¸ºäº†æ›´æ–°è®¢å•çŠ¶æ€ï¼Œåœ¨`viewWillAppear` æ—¶ï¼Œé‡æ–°è¯·æ±‚äº†æ•°æ®ã€‚åŠ è½½æ¡†å°±æ˜¯è¯·æ±‚æ•°æ®çš„æ—¶å€™æ˜¾ç¤ºçš„ã€‚åœ¨æ»‘åŠ¨è¿”å›çš„æ—¶å€™ï¼Œä¼šè§¦å‘æœ¬é¡µé¢çš„ `viewWillDisappear` å’Œä¸‹ä¸ªé¡µé¢çš„ `viewWillAppear`ã€‚è€Œè¿”å›äº‹ä»¶å¦‚æœæ”¾åœ¨`viewDidLoad`é‡Œé¢ï¼Œåˆ™ä¸èƒ½åŠæ—¶åˆ·æ–°æ•°æ®ã€‚
3. **è§£å†³åŠæ³•ï¼š** éœ€æ±‚æ—¶ï¼ŒçŠ¶æ€åŸºæœ¬ä¸ä¼šå˜ï¼Œåªæœ‰ä¸€ä¸ªæŠ¥åï¼Œä¸æŠ¥åï¼Œæ‰€ä»¥å¯ä»¥æ”¹ä¸ºåªåŠ è½½ä¸€æ¬¡ï¼Œä½†è®¢å•åŒ…æ‹¬åˆ·æ–°çŠ¶æ€ï¼Œæ»‘åŠ¨äº‹ä»¶ï¼Œå»ºè®®ä¿ç•™ã€‚



ä¾§æ»‘è¿”å›æ—¶ä»£å—è°ƒç”¨

```objective-c
/*
 1.ç¬¬ä¸€æ¬¡pushè¿›æ¥çš„æ—¶å€™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè°ƒç”¨ï¼Œparentçš„å€¼ä¸ä¸ºç©ºã€‚
 2.å½“å¼€å§‹ä½¿ç”¨ç³»ç»Ÿä¾§æ»‘çš„æ—¶å€™ï¼Œä¼šå…ˆè°ƒç”¨willMoveï¼Œè€Œparentçš„å€¼ä¸ºç©ºï¼›
 3.å½“æ»‘åŠ¨ç»“æŸåè¿”å›äº†ä¸Šä¸ªé¡µé¢ï¼Œåˆ™ä¼šè°ƒç”¨didMoveï¼Œparentçš„å€¼ä¹Ÿä¸ºç©ºï¼Œå¦‚æœæ»‘åŠ¨ç»“æŸæ²¡æœ‰è¿”å›ä¸Šä¸ªé¡µé¢ï¼Œä¹Ÿå°±æ˜¯è½»è½»åˆ’äº†ä¸€ä¸‹è¿˜åœ¨å½“å‰é¡µé¢ï¼Œé‚£ä¹ˆåˆ™ä¸ä¼šè°ƒç”¨didMoveæ–¹æ³•ã€‚
 */
- (void)willMoveToParentViewController:(UIViewController*)parent {
    [super willMoveToParentViewController:parent];
    NSLog(@"%s,%@",__FUNCTION__,parent);
    //ç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢ä¼šè°ƒç”¨ï¼Œparentä¸ä¸ºç©ºï¼Œä¾§æ»‘è¿”å›çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨ï¼Œparentä¸ºç©ºã€‚å› æ­¤æ ¹æ®parentå­—æ®µåˆ¤æ–­æ˜¯ä¸æ˜¯ä¾§æ»‘è¿”å›ã€‚ä¾§æ»‘è¿”å›æ·»åŠ æ ‡è®°
    if (!parent) {
        self.isSlidePoping = YES;//isSlidePoping;//åˆ¤æ–­æ˜¯ä¸æ˜¯æ­£åœ¨ä¾§æ»‘è¿”å›
    }
    
}

- (void)didMoveToParentViewController:(UIViewController*)parent {
    [super didMoveToParentViewController:parent];
    NSLog(@"%s,%@",__FUNCTION__,parent);
    if(!parent){
        NSLog(@"ç¦»å¼€é¡µé¢");
        
    }
    //é€€å‡ºé¡µé¢çš„æ—¶å€™ä¿®æ”¹ä¾§æ»‘æ ‡è®°
    self.isSlidePoping = NO;
}

```

-----

- ##### ç›¸å…³é—®é¢˜é“¾æ¥

  1. ###### é—®é¢˜1  èŠå¤©ä¾§æ»‘è¿”å›ï¼Œå‘é€è®¢å•æ¶ˆæ¯æ¶ˆå¤±æ—¶é—´

     1. **èƒŒæ™¯ï¼š** å‘é€è®¢å•æ¶ˆæ¯ï¼Œåœ¨è®¢å•é¡µé¢ç‚¹å‡»è”ç³»å¯¹æ–¹ï¼Œè·³åˆ°èŠå¤©é¡µé¢ï¼Œå‡ºç°å‘é€æ¶ˆæ¯ï¼Œç‚¹å‡»å‘é€ï¼Œåˆ™å‘é€è®¢å•ï¼Œæ²¡ç‚¹ï¼Œç‚¹è¿”å›ï¼Œåˆ™è¿”å›é¡µé¢ï¼Œå‘é€è®¢å•æ¶ˆæ¯ä¸ä¿ç•™ã€‚

     2. **å®ç°åŸç†ï¼š** å‘é€è®¢å•è¿›å…¥èŠå¤©æ—¶ï¼Œä¼ æ¥è®¢å•`model`ï¼Œåœ¨é¡µé¢å‡ºç°çš„æ—¶å€™`insertMessage`æ·»åŠ æœ¬åœ°æ¶ˆæ¯ï¼Œä½†ä¸å‘é€ç»™å¯¹æ–¹ã€‚åœ¨é¡µé¢æ¶ˆå¤±æ—¶ï¼Œæˆ–é¡µé¢è¢«æ€æ­»çš„æ—¶å€™ï¼Œä»æ•°æ®æºå€’æ•°ï¼Œç§»é™¤å‘é€è®¢å•æ¶ˆæ¯ã€‚é‡‡ç”¨ `insertMessage`ï¼Œä¼šä¿å­˜åœ¨æœ¬åœ°æ•°æ®åº“ï¼Œä½†æ˜¯åœ¨ä¸ºäº†é˜²æ­¢åœ¨åˆ·æ–°æ•°æ®çš„æ—¶å€™é‡æ–°è¯»å–æ•°æ®æºï¼ŒæŠŠæ•°æ®ç§»é™¤æ‰ã€‚åœ¨é¡µé¢æ¶ˆå¤±çš„æ—¶å€™ï¼Œåˆ¤æ–­æ•°æ®æºï¼Œç”¨åˆ é™¤æ¶ˆæ¯çš„æ–¹å¼ç§»é™¤æ•°æ®ã€‚

        â€‹	åœ¨æ·»åŠ å’Œç§»é™¤æ¶ˆæ¯çš„æ—¶é—´ï¼Œé‡‡ç”¨äº†`viewWillAppear`å’Œ `viewDidDispear`ã€‚
        â€‹	é€‰æ‹©è¿‡ç¨‹ï¼šå¼€å§‹é€‰æ‹©`viewWillAppear` `viewWillDisappear`,æ˜¯ä¸€å¯¹æ•°æ®ï¼Œä¸ä¼šé”™è¯¯ã€‚ä½†é¡µé¢è¿”å›çš„æ—¶å€™å°±ä¼šåœ¨ä¾§æ»‘å¼€å§‹æ—¶å°±ç§»é™¤äº†æ¶ˆæ¯ï¼Œä¼šæ˜¾ç¤ºé—ªä¸€ä¸‹ã€‚è€Œä¸”é¡µé¢è¿˜æ²¡æœ‰è¿”å›ï¼Œå‘é€è®¢å•æ¶ˆæ¯ä¸åº”è¯¥è¢«ç§»é™¤ã€‚äºæ˜¯å°±æŠŠç§»é™¤æ¶ˆæ¯æ”¾åœ¨äº†`viewDidDispear`ï¼Œä½†è¿™æ ·å¦‚æœé¡µé¢ä¾§æ»‘è¿”å›åæ¾å¼€æ‰‹æŒ‡ï¼Œè¿˜ä¼šè°ƒç”¨viewWillAppear,é€ æˆæ¶ˆæ¯é‡å¤ã€‚åŒæ—¶ä¹Ÿä¼šè°ƒç”¨èŠå¤©é¡µé¢çš„viewDidAppear,æ‰€ä»¥å¹¶ä¸èƒ½ç§»åŠ¨åˆ°viewDidAppearæ¥è§£å†³ã€‚è€Œç§»åŠ¨åˆ°viewDidAppearçš„è¯ä¹Ÿä¼šåœ¨é¡µé¢å‡ºç°ä¸€ä¼šä¹‹åæ‰æ˜¾ç¤ºæ¶ˆæ¯ï¼Œæ„Ÿè§‰ä¸åˆç†ã€‚æ‰€ä»¥è¦åˆ¤æ–­ä¾§æ»‘è¿”å›äº‹ä»¶ã€‚

     3. **è§£å†³åŠæ³•ï¼š**

        é¡µé¢å‡ºç°ï¼Œæ¶ˆå¤±ä¹‹å‰ä¼šè°ƒç”¨`- (void)willMoveToParentViewController:(UIViewController *)parent` å’Œ `- (void)didMoveToParentViewController:(UIViewController *)parent`ã€‚æŸ¥åˆ°çš„è§£é‡Šå¦‚ä¸‹ã€‚

        ```objective-c
         /*
        1.ç¬¬ä¸€æ¬¡pushè¿›æ¥çš„æ—¶å€™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè°ƒç”¨ï¼Œparentçš„å€¼ä¸ä¸ºç©ºã€‚
        2.å½“å¼€å§‹ä½¿ç”¨ç³»ç»Ÿä¾§æ»‘çš„æ—¶å€™ï¼Œä¼šå…ˆè°ƒç”¨willMoveï¼Œè€Œparentçš„å€¼ä¸ºç©ºï¼›
        3.å½“æ»‘åŠ¨ç»“æŸåè¿”å›äº†ä¸Šä¸ªé¡µé¢ï¼Œåˆ™ä¼šè°ƒç”¨didMoveï¼Œparentçš„å€¼ä¹Ÿä¸ºç©ºï¼Œå¦‚æœæ»‘åŠ¨ç»“æŸæ²¡æœ‰è¿”å›ä¸Šä¸ªé¡µé¢ï¼Œä¹Ÿå°±æ˜¯è½»è½»åˆ’äº†ä¸€ä¸‹è¿˜åœ¨å½“å‰é¡µé¢ï¼Œé‚£ä¹ˆåˆ™ä¸ä¼šè°ƒç”¨didMoveæ–¹æ³•ã€‚
        */
        ```

        å®˜æ–¹æ–‡æ¡£è§£é‡Š

        ```objective-c
        //åœ¨è§†å›¾æ§åˆ¶å™¨æ·»åŠ æˆ–ä»å®¹å™¨è§†å›¾æ§åˆ¶å™¨ä¸­åˆ é™¤ä¹‹å‰è°ƒç”¨ã€‚
        - (void)willMoveToParentViewController:(UIViewController*)parent;
        å½“è§†å›¾æ§åˆ¶å™¨éœ€è¦çŸ¥é“å®ƒå·²æ·»åŠ åˆ°å®¹å™¨æ—¶ï¼Œå®ƒå¯ä»¥è¦†ç›–æ­¤æ–¹æ³•ã€‚
        å¦‚æœè¦å®ç°è‡ªå·±çš„å®¹å™¨è§†å›¾æ§åˆ¶å™¨ï¼Œåˆ™å¿…é¡»åœ¨è°ƒç”¨removeFromParentViewControlleræ–¹æ³•ä¹‹å‰è°ƒç”¨å­è§†å›¾æ§åˆ¶å™¨çš„willMoveToParentViewControllerï¼šæ–¹æ³•ï¼Œå¹¶ä¼ å…¥çˆ¶å€¼nilã€‚
        å½“æ‚¨çš„è‡ªå®šä¹‰å®¹å™¨è°ƒç”¨addChildViewControllerï¼šæ–¹æ³•æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è°ƒç”¨è§†å›¾æ§åˆ¶å™¨çš„willMoveToParentViewControllerï¼šæ–¹æ³•ä½œä¸ºå­é¡¹æ·»åŠ ï¼Œç„¶åå†æ·»åŠ å®ƒã€‚
        å‚æ•°  parent  çˆ¶è§†å›¾æ§åˆ¶å™¨ï¼Œå¦‚æœæ²¡æœ‰çˆ¶è§†å›¾ï¼Œåˆ™ä¸ºnilã€‚
        ```

        ```objective-c
        //åœ¨å®¹å™¨è§†å›¾æ§åˆ¶å™¨ä¸­æ·»åŠ æˆ–åˆ é™¤è§†å›¾æ§åˆ¶å™¨åè°ƒç”¨ã€‚
        - (void)didMoveToParentViewController:(UIViewController *)parent;
        Discussion
        å½“è§†å›¾æ§åˆ¶å™¨æƒ³è¦å¯¹æ·»åŠ åˆ°å®¹å™¨åšå‡ºååº”æ—¶ï¼Œå®ƒå¯ä»¥è¦†ç›–æ­¤æ–¹æ³•ã€‚
        å¦‚æœè¦å®ç°è‡ªå·±çš„å®¹å™¨è§†å›¾æ§åˆ¶å™¨ï¼Œå®ƒå¿…é¡»åœ¨è½¬æ¢åˆ°æ–°æ§åˆ¶å™¨å®Œæˆåè°ƒç”¨å­è§†å›¾æ§åˆ¶å™¨çš„didMoveToParentViewControllerï¼šæ–¹æ³•ï¼Œæˆ–è€…å¦‚æœæ²¡æœ‰è½¬æ¢ï¼Œåˆ™åœ¨è°ƒç”¨addChildViewControllerï¼šæ–¹æ³•ä¹‹åç«‹å³è°ƒç”¨ã€‚
        removeFromParentViewControlleræ–¹æ³•åœ¨åˆ é™¤å­è§†å›¾åè‡ªåŠ¨è°ƒç”¨å­è§†å›¾æ§åˆ¶å™¨çš„didMoveToParentViewControllerï¼šæ–¹æ³•ã€‚
        å‚æ•°  parent  çˆ¶è§†å›¾æ§åˆ¶å™¨ï¼Œå¦‚æœæ²¡æœ‰çˆ¶è§†å›¾ï¼Œåˆ™ä¸ºnil
        ```

        
-----

#### attributeString LineBreakMode æ–‡å­—æ˜¾ç¤ºä¸å…¨
1. **äº§ç”Ÿé—®é¢˜:**  ç”¨h5String æ¥æ˜¾ç¤ºalertView è¿™æ ·å°±å¯ä»¥ç”±åå°æ§åˆ¶æç¤ºæ¡†çš„æ˜¾ç¤ºäº†ã€‚ä½†æ˜¯ä»Šå¤©é‡åˆ°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œåœ¨plusä¸Šï¼Œæœ€åä¸€è¡Œæ–‡å­—ä¸æ˜¾ç¤ºã€‚ä¸€ç›´ä»¥ä¸ºæ˜¯alertViewæ˜¾ç¤ºé—®é¢˜ï¼Œåˆ†æäº†åŠå¤©ï¼Œå‘ç°è¿˜æ˜¯æ™®é€šlabelçš„é—®é¢˜ã€‚é—®é¢˜ä»£ç å’Œæ•ˆæœå¦‚ä¸‹ï¼š

   ![å±å¹•å¿«ç…§ 2019-03-25 ä¸‹åˆ4.22.06](https://ws1.sinaimg.cn/large/006tKfTcly1g1f49eroy3j30kq0rkjvf.jpg)

 ```objective-c
     NSString *h5str = @"<font color='#111111'><strong><size value='14'>å·¥ç¨‹å¸ˆä¸ªäºº:</size></strong><br/><size value='13'>â‘ ã€å®æ”¶é‡‘é¢=å·¥å•é‡‘é¢*(1-6%)-ä¸ªäººæ‰€å¾—ç¨<br/>â‘¡ã€å¹³å°æŒ‰æœˆåˆå¹¶ç¼´ç¨ï¼Œå·¥ç¨‹å¸ˆæç°æ—¶å¹³å°ä¼šæ ¹æ®å½“æœˆæç°æ€»é‡‘é¢è®¡ç®—ä¸ªç¨ã€‚å›½å®¶ç›¸å…³çš„ç¨æ³•è§„å®šï¼Œä¸ªäººå¶ç„¶æ‰€å¾—</font><font color='#FF0000'><strong>è¶…è¿‡800å…ƒ</strong></font><font color='#111111'>éœ€è¦äº¤çº³</font><font color='#FF0000'><strong>16%-25%</strong></font><font color='#111111'>çš„ç¨</font></size><font color='#0076FF'><a href=\"/tax/taxIntroduce.html\"><strong><size value='13'>(æŸ¥çœ‹</size><size value='10'>>></size><size value='13'>)</size></strong></a></font>ï¼Œ<size value='13'><font color='#111111'>åŒæ—¶å¼ºåˆ¶è¦æ±‚å¹³å°ä»£æ”¶ä»£ç¼´ã€‚ä¸ªäººå¶ç„¶æ‰€å¾—æœªè¶…è¿‡800å…ƒï¼Œåˆ™æ— éœ€çº³ç¨ã€‚<br/>â‘¢ã€å¹³å°ä»…æ”¶å–6%çš„ç®¡ç†è´¹ï¼Œç”¨äºå¹³å°ç»´æŠ¤å’Œå‡çº§ï¼Œä¸ºæ‚¨æä¾›æ›´å¥½çš„æœåŠ¡ã€‚</font></size><br/><br/><strong><size value='14'><font color='#111111'>æœåŠ¡å•† (ä¼ä¸š):</font></size></strong><br/><size value='13'><font color='#111111'>â‘ ã€æœåŠ¡å•†å®æ”¶é‡‘é¢=å·¥å•é‡‘é¢*(1-6%)ï¼Œå…¶ä¸­6%ä¸ºå¹³å°ç®¡ç†è´¹ã€‚<br/>â‘¡ã€æœåŠ¡å•†(ä¼ä¸š)æ— éœ€ç¼´çº³ä¸ªäººæ‰€å¾—ç¨ï¼Œä½†éœ€è¦å¼€å…·</font><font color='#FF0000'><strong>æœåŠ¡ç±»å¢å€¼ç¨ç¥¨</strong></font><font color='#111111'>ç»™å¹³å°ã€‚</font></size>";
    
    
//    h5str = @"å·¥ç¨‹å¸ˆä¸ªäºº:\nâ‘ ã€å®æ”¶é‡‘é¢=å·¥å•é‡‘é¢*(1-6%)-ä¸ªäººæ‰€å¾—ç¨\nâ‘¡ã€å¹³å°æŒ‰æœˆåˆå¹¶ç¼´ç¨ï¼Œå·¥ç¨‹å¸ˆæç°æ—¶å¹³å°ä¼šæ ¹æ®å½“æœˆæç°æ€»é‡‘é¢è®¡ç®—ä¸ªç¨ã€‚å›½å®¶ç›¸å…³çš„ç¨æ³•è§„å®šï¼Œä¸ªäººå¶ç„¶æ‰€å¾—è¶…è¿‡800å…ƒéœ€è¦äº¤çº³16%-25%çš„ç¨(æŸ¥çœ‹>>)ï¼ŒåŒæ—¶å¼ºåˆ¶è¦æ±‚å¹³å°ä»£æ”¶ä»£ç¼´ã€‚ä¸ªäººå¶ç„¶æ‰€å¾—æœªè¶…è¿‡800å…ƒï¼Œåˆ™æ— éœ€çº³ç¨ã€‚\nâ‘¢ã€å¹³å°ä»…æ”¶å–6%çš„ç®¡ç†è´¹ï¼Œç”¨äºå¹³å°ç»´æŠ¤å’Œå‡çº§ï¼Œä¸ºæ‚¨æä¾›æ›´å¥½çš„æœåŠ¡ã€‚\n\næœåŠ¡å•† (ä¼ä¸š):\nâ‘ ã€æœåŠ¡å•†å®æ”¶é‡‘é¢=å·¥å•é‡‘é¢*(1-6%)ï¼Œå…¶ä¸­6%ä¸ºå¹³å°ç®¡ç†è´¹ã€‚\nâ‘¡ã€æœåŠ¡å•†(ä¼ä¸š)æ— éœ€ç¼´çº³ä¸ªäººæ‰€å¾—ç¨ï¼Œä½†éœ€è¦å¼€å…·æœåŠ¡ç±»å¢å€¼ç¨ç¥¨ç»™å¹³å°ã€‚";
    
    if ([h5str containsString:@"<size"]) {
        h5str = [h5str stringByReplacingOccurrencesOfString:@"<size value='" withString:@"<span style='font-size:"];
        h5str = [h5str stringByReplacingOccurrencesOfString:@"</size>" withString:@"</span>"];
    }

    NSMutableArray *linkArrr = [[NSMutableArray alloc] init];
    if ([h5str containsString:@"<a"]) {
        h5str = [h5str stringByReplacingOccurrencesOfString:@"<a" withString:@"<link"];
        h5str = [h5str stringByReplacingOccurrencesOfString:@"</a>" withString:@"</link>"];

        NSRegularExpression *regex = [NSRegularExpression regularExpressionWithPattern:@"<link .*>*</link>" options:0 error:nil];
        NSArray *matches = [regex matchesInString:h5str options:0 range:NSMakeRange(0,h5str.length)];
        for(NSTextCheckingResult *result in [matches objectEnumerator]) {
            NSRange range = [result range];
            NSString *linkString = [h5str substringWithRange:range]; //å–åˆ°çš„é“¾æ¥string-åŒ…æ‹¬æ ‡ç­¾çš„

            //é“¾æ¥stringå»æ‰æ ‡ç­¾
            NSRegularExpression *regularExpretion=[NSRegularExpression regularExpressionWithPattern:@"<[^>]*>|\n" options:0 error:nil];
            NSString *stringLink=[regularExpretion stringByReplacingMatchesInString:linkString options:NSMatchingReportProgress range:NSMakeRange(0, linkString.length) withTemplate:@""];

            [linkArrr addObject:stringLink];
        }
    }
    
    NSAttributedString * attrStr = [[NSAttributedString alloc] initWithData:[h5str dataUsingEncoding:NSUnicodeStringEncoding] options:@{ NSDocumentTypeDocumentAttribute: NSHTMLTextDocumentType } documentAttributes:nil error:nil];
    
    
    UIView *customView = [[UIView alloc] init];
    customView.backgroundColor = [UIColor grayColor];
    
    UILabel *textLabel = [[UILabel alloc] init];
    textLabel.font = [UIFont systemFontOfSize:13];
    textLabel.numberOfLines = 0;
    textLabel.backgroundColor = [UIColor grayColor];
    textLabel.attributedText = attrStr;
//    textLabel.lineBreakMode = NSLineBreakByTruncatingTail;// NSLineBreakByWordWrapping 
    
    CGFloat panding = 53 + 16;
    textLabel.frame = CGRectMake(panding, panding, self.view.frame.size.width - panding - panding, 400);
    
    [self.view addSubview:textLabel];
 ```



éœ€è¦åé¢çš„ä¸€è¡Œå­—æ²¡æœ‰æ˜¾ç¤ºï¼Œä½†labelè¿˜æœ‰å¾ˆå¤šåœ°æ–¹ã€‚

ä¹‹åæ˜¯çœ‹åˆ°ä¸€ä¸ªæ–‡ç« ï¼Œè¯´`attributedTex`tä¸æ˜¾ç¤ºåé¢çš„â€¦ [é“¾æ¥](https://blog.csdn.net/wsh7365062/article/details/52237703) ç„¶åå°±è¯•äº†ä¸€ä¸‹æ·»åŠ â€¦â€¦ç„¶åå°±å¯ä»¥äº†â€¦â€¦ï¼ˆå°±æ˜¯æ³¨æ‰çš„é‚£ä¸€è¡Œï¼‰

æƒ³çŸ¥é“ä¸ºä»€ä¹ˆè®¾ç½®åˆ†è¡Œæ–¹å¼æ˜¯`NSLineBreakByWordWrapping` å°±ä¸è¡Œã€‚



#### å·²ç»å‘å¸ƒçš„ç¨‹åºï¼Œfirå’Œè’²å…¬è‹±ä¸Šçš„çªç„¶éƒ½ä¸èƒ½å®‰è£…äº†


ä»Šå¤©ä¸‹åˆï¼Œå…ˆæ˜¯å¨Ÿå¨Ÿè¯´ç‚¹å‡»æç°æŠ¥é”™å´©æºƒï¼Œä¹‹åç‚¹ä¸å¼€ï¼Œå°±æ‰“å¼€å°±å´©æºƒã€‚ä»¥ä¸ºæ˜¯ä¿å­˜ä»€ä¹ˆä¸œè¥¿å­—æ®µæœ‰é—®é¢˜ï¼Œå°±è¿æœºæµ‹è¯•ï¼Œæ‰¾åˆ°æç°å´©æºƒçš„åŸå› ï¼ˆattributeString å…ˆåˆ¤æ–­äº†contingString,ååˆ¤æ–­iskindOfClass:,contingStringæŠ¥é”™ï¼Œåº”è¯¥åè¿‡æ¥ï¼‰ã€‚ä½†æ²¡å‘ç°ä¸èƒ½æ‰“å¼€çš„é—®é¢˜ã€‚ä¹‹åä¸ºäº†çœäº‹å°±ç›´æ¥è¿çº¿å®‰è£…äº†

ç„¶åæ˜¯å°ç§‘ç§‘è¯´åº”ç”¨æ‰“ä¸å¼€ï¼Œè·Ÿå¨Ÿå¨Ÿçš„é—®é¢˜ä¸€æ ·ï¼Œéƒ½æ˜¯å·¥ç¨‹å¸ˆç«¯ï¼Œè¿çº¿è§£å†³ï¼ŒæœªæŸ¥æ‰¾åŸå› ã€‚
ä¹‹åå®¢æˆ·ç«¯ä¹Ÿæ˜¯æ‰“ä¸å¼€ã€‚å¼€å§‹æ£€æŸ¥ã€‚å› ä¸ºæ˜¯ä»¥å‰çš„ç‰ˆæœ¬ï¼Œåªèƒ½æ˜¯è¯ä¹¦é—®é¢˜ï¼Œæˆ–è€…firé—®é¢˜ï¼ŸğŸ˜¢ï¼›
è¯•äº†è’²å…¬è‹±ï¼Œfir,éƒ½æ˜¯èƒ½ä¸‹è½½ï¼Œä½†æ˜¯ä¸‹è½½åå˜ç°ï¼Œä¸ä¼šå˜å›æ¥ã€‚é¢„æµ‹æ˜¯è¯ä¹¦é—®é¢˜ã€‚
æ‰“å¼€devicecæŸ¥çœ‹logï¼Œ çœ‹åˆ°æŠ¥é”™

```
[com.shenzhou.kehuduan] Bootstrap failed with error: <NSError: 0x281be17a0; domain: BKSProcessErrorDomain; code: 1 (bootstrap-failed); reason: "Failed to start job">

[com.shenzhou.kehuduan] Bootstrap failed with error: <NSError: 0x281bd0690; domain: BKSProcessErrorDomain; code: 1 (bootstrap-failed); reason: "Failed to start job">

Bootstrapping failed for <FBApplicationProcess: 0x10eb581e0; com.shenzhou.kehuduan; pid: -1> with error: Error Domain=BKSProcessErrorDomain Code=1 "Unable to bootstrap process with bundleID com.shenzhou.kehuduan" UserInfo={NSLocalizedDescription=Unable to bootstrap process with bundleID com.shenzhou.kehuduan, BKSProcessExitReason=0, NSLocalizedFailureReason=Failed to start job, NSUnderlyingError=0x281be1530 {Error Domain=NSPOSIXErrorDomain Code=3 "No such process" UserInfo={NSLocalizedFailureReason=The process failed to exec, NSLocalizedRecoverySuggestion=Consult /var/log/com.apple.xpc.launchd/launchd.log for more information, NSLocalizedDescription=Unable to get valid task name port right for pid 1133}}, BSErrorCodeDescription=bootstrap-failed}
```
çœ‹åˆ°ä¸€ç¯‡æ–‡ç« è¯´æŸ¥çœ‹deviceã€‚ç™»å½•appledevelepe, deviceå·²ç»æ³¨å†Œäº†ã€‚ä¹‹åçœ‹è’²å…¬è‹±çš„é”™è¯¯åŸå› æ–‡æ¡£ï¼Œç”¨å·¥å…·æŸ¥çœ‹logï¼Œçœ‹åˆ°æŠ¥é”™

```
<Notice>: -[IXSCoordinatedAppInstall _onQueue_acquireAssertionAndDoInstall]_block_invoke: Installation for <IXSCoordinatedAppInstall<0x14b200000> identifier:com.shenzhou.gongchengshi uuid:539C649A-1449-4E77-98DB-D897582109A8 intent:IXCoordinatorIntentInitiating creator/appDRI:App Store importance:UserWaiting state:IXAppCoordinationStateWaitingForInstall> failed: Error Domain=MIInstallerErrorDomain Code=13 "Failed to verify code signature of /private/var/installd/Library/Caches/com.apple.mobile.installd.staging/temp.JE9al0/extracted/Payload/Engineer.app : 0xe8008015 (A valid provisioning profile for this executable was not found.)" UserInfo={LibMISErrorNumber=-402620395, LegacyErrorString=ApplicationVerificationFailed, SourceFileLine=199, FunctionName=+[MICodeSigningVerifier 
```

æŸ¥ `Failed to verify code signature of` çœ‹åˆ°ä¸€ç¯‡æ–‡ç« è¯´çš„

```
ç¨‹åºå‘å¸ƒåï¼Œå‘ç°ä¸€ä¸ªbug,éœ€è¦åœ¨è‡ªå·±æ‰‹æœºè°ƒè¯•æ—¶ï¼Œå‡ºç°ï¼ša valid provisioning profile for this executable was not foundé”™è¯¯.

åŸæ¥æ˜¯å› ä¸ºå‘å¸ƒçš„æ—¶å€™æŠŠschemaé‡Œçš„"Build Configuration"æ”¹æˆäº†releaseã€‚è€Œreleaseå¯¹åº”çš„provisionæ˜¯ç”¨å‘å¸ƒè¯ä¹¦çš„ã€‚æŠŠ"Build Configuration"æ”¹æˆäº†debugå°±å¥½äº†ã€‚

because the App Transport Security policy requires the use of a secure connection
```

æŒ‰ç…§ä¿®æ”¹ï¼Œç„¶åæ‰“åŒ…ï¼Œä½†æ˜¯è·Ÿå¹³å¸¸æ‰“åŒ…ä¸ä¸€æ ·ï¼Œæç¤ºäº†è¿™ä¸ª

![å±å¹•å¿«ç…§ 2019-04-09 ä¸‹åˆ5.06.55](https://tva1.sinaimg.cn/large/006tNbRwly1g9zrp8sod1j31h90u00xr.jpg)

æ„Ÿè§‰ä¸å¯¹ï¼Œè®©æˆ‘é‡æ–°åˆ›å»ºè¯ä¹¦ï¼Œ

ç„¶åå°±åœ¨å¼€å‘è€…ç½‘ç«™è¯ä¹¦éƒ¨åˆ†downloadäº†è¯ä¹¦

![image-20190409175711423](https://ws1.sinaimg.cn/large/006tNc79ly1g1wj962os1j30ey09igog.jpg)

é‡æ–°å®‰è£…è¯ä¹¦ï¼Œç„¶ååœ¨é’¥åŒ™ä¸²ä¸­çœ‹åˆ°äº† è¿‡æœŸæ—¶é—´ï¼šä»Šå¤©ä¸‹åˆâ€¦â€¦

åŸå› ï¼šè¯ä¹¦è¿‡æœŸ---æ›´æ–°è¯ä¹¦ ç„¶åå®‰è£…

![å›¾ç‰‡](https://tva1.sinaimg.cn/large/006tNbRwly1g9zrob667qj31j50u0n6o.jpg)



ç„¶åè¿˜æ˜¯åŒä¸€ä¸ªåŒ…ï¼Œåœ¨æ‰“åŒ…ï¼Œå°±å¯ä»¥äº†ã€‚è¯´æ˜çš„ç¡®æ˜¯æˆ‘æœ¬åœ°è¯ä¹¦çš„é—®é¢˜ã€‚é‡æ–°æ‰“åŒ…äº†æ‰€æœ‰åº”ç”¨ï¼Œé€šçŸ¥æ›´æ–°ã€‚



æ³¨ï¼šä¹‹å‰è§‰å¾—è‡ªåŠ¨ç®¡ç†è¯ä¹¦å°±å¯ä»¥äº†ï¼Œçœ‹èµ·æ¥ä¸æ˜¯ã€‚åœ¨æ‰“åŒ…çš„æ—¶å€™ä¼šéªŒè¯æœ¬åœ°çš„è¯ä¹¦ï¼Œå¦‚æœæ—¶é—´åˆ°äº†å°±ä¸èƒ½å®‰è£…äº†ã€‚



æ³¨2.[è¯ä¹¦ç­¾ååŸç†](https://www.jianshu.com/p/fc56a70ee4fb)
ä½¿ç”¨RSA,éå¯¹ç§°ç­¾åæœºåˆ¶ï¼Œä¸¤ä»½å¯†é’¥ï¼Œå…¬é’¥ç§é’¥ã€‚

ä»AppStoreå®‰è£…ï¼Œè‹¹æœå®˜æ–¹å£°ç§°ä¸€å¯¹å…¬é’¥ç§é’¥ï¼Œæ‰‹æœºå†…ç½®ä¸€ä¸ªå…¬é’¥ï¼Œç§é’¥ç”±è‹¹æœåå°ä¿å­˜ï¼Œä¸Šä¼ appæ—¶ï¼Œè‹¹æœåå°ç”¨ç§é’¥å¯¹appæ•°æ®è¿›è¡Œmd5å€¼ç­¾åï¼Œä¸‹è½½åï¼Œç”±å…¬é’¥éªŒè¯ç­¾åã€‚ä»¥æ­¤ä¿è¯appæ˜¯ç”±è‹¹æœè®¤è¯çš„ã€‚

å…¶ä»–å®‰è£…æ–¹å¼ï¼šä¼ä¸šå¼€å‘è¿™è´¦å·In-House.ä¼ä¸šåˆ†é…é™åˆ¶ï¼ˆé™åˆ¶idï¼‰AD-Hoc.

éªŒè¯ï¼š 

1. macç”µè„‘ï¼ˆé’¥åŒ™ä¸²ï¼‰ç”Ÿæˆå…¬é’¥M,ç§é’¥M.

2. macæŠŠå…¬é’¥Mé€šè¿‡CSRæ–‡ä»¶ç”³è¯·è¯ä¹¦ï¼Œè‹¹æœæœåŠ¡å™¨ç”Ÿæˆè¯ä¹¦ä¼ ç»™macï¼Œè¯ä¹¦åŒ…æ‹¬å…¬é’¥M,å’ŒHASH.

3. å¼€å‘æ˜¯ï¼Œç¼–è¯‘å®Œæˆåï¼Œç”¨æœ¬åœ°çš„ç§é’¥Må¯¹app è¿›è¡Œç­¾åã€‚å¹¶æ‰“åŒ… åŒ…å«å…¬é’¥M,å’ŒHASHçš„è¯ä¹¦ï¼Œå®‰è£…åˆ°æ‰‹æœº

4. éªŒè¯æ‰‹æœºçš„æ—¶å€™ï¼Œæ‰‹æœºä¸­æœ‰å…¬é’¥A, iOSç³»ç»Ÿè·å¾—è¯ä¹¦ï¼Œé€šè¿‡ç³»ç»Ÿå†…çš„å…¬é’¥Aå»éªŒè¯æ•°å­—ç­¾åæ˜¯ä¸æ˜¯å¯¹çš„ã€‚



è€Œåœ¨é¿å…è¢«æ»¥ç”¨ä¸Šï¼Œè‹¹æœæ·»åŠ äº†æè¿°æ–‡ä»¶Provision profile.åœ¨ç”Ÿæˆè¯ä¹¦æ—¶ï¼Œæ·»åŠ æè¿°æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«è®¾å¤‡ids,AppId,Entitlements

```
åœ¨ Mac ä¸Šç”Ÿæˆä¸€å¯¹å…¬ç§é’¥ï¼Œè¿™é‡Œç§°ä¸ºå…¬é’¥Mï¼Œç§é’¥Mã€‚
è‹¹æœè‡ªå·±æœ‰å›ºå®šçš„ä¸€å¯¹å…¬ç§é’¥ï¼Œè·Ÿä¸Šé¢ AppStore ä¾‹å­ä¸€æ ·ï¼Œç§é’¥åœ¨è‹¹æœåå°ï¼Œå…¬é’¥åœ¨æ¯ä¸ªiOSè®¾å¤‡ä¸Šã€‚è¿™é‡Œç§°ä¸ºå…¬é’¥Aï¼Œç§é’¥Aã€‚A:Apple
æŠŠå…¬é’¥Mä¼ åˆ°è‹¹æœåå°ï¼Œç”¨è‹¹æœåå°é‡Œçš„ç§é’¥Aå»ç­¾åå…¬é’¥Mã€‚å¾—åˆ°ä¸€ä»½æ•°æ®åŒ…å«äº†å…¬é’¥Mä»¥åŠå…¶ç­¾åï¼ŒæŠŠè¿™ä»½æ•°æ®ç§°ä¸ºè¯ä¹¦ã€‚
åœ¨è‹¹æœåå°ç”³è¯·AppIDï¼Œé…ç½®å¥½è®¾å¤‡IDåˆ—è¡¨å’ŒAPPå¯ä½¿ç”¨çš„æƒé™ï¼Œå†åŠ ä¸Šç¬¬3æ­¥çš„è¯ä¹¦ï¼Œç»„æˆçš„æ•°æ®ç”¨ç§é’¥Aç­¾åï¼ŒæŠŠæ•°æ®å’Œç­¾åä¸€èµ·ç»„æˆä¸€ä¸ªProvisioning Profileæ–‡ä»¶ï¼Œä¸‹è½½åˆ°æœ¬åœ°Macå¼€å‘æœºã€‚
åœ¨å¼€å‘æ—¶ï¼Œç¼–è¯‘å®Œä¸€ä¸ªAPPåï¼Œç”¨æœ¬åœ°çš„ç§é’¥Må¯¹è¿™ä¸ªAPPè¿›è¡Œç­¾åï¼ŒåŒæ—¶æŠŠç¬¬4æ­¥å¾—åˆ°çš„Provisioning Profileæ–‡ä»¶æ‰“åŒ…è¿›APPé‡Œï¼Œæ–‡ä»¶åä¸º embedded.mobileprovisionï¼ŒæŠŠAPPå®‰è£…åˆ°æ‰‹æœºä¸Šã€‚
åœ¨å®‰è£…æ—¶ï¼ŒiOSç³»ç»Ÿå–å¾—è¯ä¹¦ï¼Œé€šè¿‡ç³»ç»Ÿå†…ç½®çš„å…¬é’¥Aï¼Œå»éªŒè¯ embedded.mobileprovisionçš„æ•°å­—ç­¾åæ˜¯å¦æ­£ç¡®ï¼Œé‡Œé¢çš„è¯ä¹¦ç­¾åä¹Ÿä¼šå†éªŒä¸€éã€‚
ç¡®ä¿äº†embedded.mobileprovisioné‡Œçš„æ•°æ®éƒ½æ˜¯è‹¹æœæˆæƒä»¥åï¼Œå°±å¯ä»¥å–å‡ºé‡Œé¢çš„æ•°æ®ï¼Œåšå„ç§éªŒè¯ï¼ŒåŒ…æ‹¬ç”¨å…¬é’¥MéªŒè¯APPç­¾åï¼ŒéªŒè¯è®¾å¤‡IDæ˜¯å¦åœ¨IDåˆ—è¡¨ä¸Šï¼ŒAppIDæ˜¯å¦å¯¹åº”å¾—ä¸Šï¼Œæƒé™å¼€å…³æ˜¯å¦è·ŸAPPé‡Œçš„Entitlementså¯¹åº”ç­‰ã€‚
å¼€å‘è€…è¯ä¹¦ä»ç­¾ååˆ°è®¤è¯æœ€ç»ˆè‹¹æœé‡‡ç”¨çš„æµç¨‹å¤§è‡´æ˜¯è¿™æ ·ï¼Œè¿˜æœ‰ä¸€äº›ç»†èŠ‚åƒè¯ä¹¦æœ‰æ•ˆæœŸ/è¯ä¹¦ç±»å‹ç­‰å°±ä¸ç»†è¯´äº†ã€‚

ä¸Šé¢çš„æ­¥éª¤å¯¹åº”åˆ°æˆ‘ä»¬å¹³å¸¸å…·ä½“çš„æ“ä½œå’Œæ¦‚å¿µæ˜¯è¿™æ ·çš„ï¼š
ç¬¬1æ­¥å¯¹åº”çš„æ˜¯keychainé‡Œçš„â€œä»è¯ä¹¦é¢å‘æœºæ„è¯·æ±‚è¯ä¹¦â€ï¼Œè¿™é‡Œå°±æœ¬åœ°ç”Ÿæˆäº†ä¸€å¯¹å…¬ç§é’¥ï¼Œä¿å­˜çš„CertificateSigningRequestå°±æ˜¯å…¬é’¥ï¼Œç§é’¥ä¿å­˜åœ¨æœ¬åœ°ç”µè„‘é‡Œã€‚
ç¬¬2æ­¥è‹¹æœè‡ªå·±å¤„ç†ï¼Œæˆ‘ä»¬ä¸ç”¨ç®¡ã€‚
ç¬¬3æ­¥å¯¹åº”æŠŠCertificateSigningRequestä¼ åˆ°è‹¹æœåå°ç”Ÿæˆè¯ä¹¦ï¼Œå¹¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚è¿™æ—¶æœ¬åœ°æœ‰ä¸¤ä¸ªè¯ä¹¦ï¼Œä¸€ä¸ªæ˜¯ç¬¬1æ­¥ç”Ÿæˆçš„ï¼Œä¸€ä¸ªæ˜¯è¿™é‡Œä¸‹è½½å›æ¥çš„ï¼Œkeychainä¼šæŠŠè¿™ä¸¤ä¸ªè¯ä¹¦å…³è”èµ·æ¥ï¼Œå› ä¸ºå®ƒä»¬çš„å…¬ç§é’¥æ˜¯å¯¹åº”çš„ï¼Œåœ¨Xcodeé€‰æ‹©ä¸‹è½½å›æ¥çš„è¯ä¹¦çš„æ—¶ï¼Œå®é™…ä¸Šä¼šæ‰¾åˆ°keychainé‡Œé¢å¯¹åº”çš„ç§é’¥å»ç­¾åã€‚è¿™é‡Œç§é’¥åªæœ‰ç”Ÿæˆå®ƒçš„è¿™å°Macæ‰æœ‰ï¼Œå¦‚æœåˆ«çš„Macä¹Ÿè¦ç¼–è¯‘ç­¾åè¿™ä¸ªAppï¼ŒæŠŠç§é’¥å¯¼å‡ºç»™å…¶ä»–Macä½¿ç”¨ï¼Œåœ¨keychainé‡Œé¢å¯¼å‡ºç§é’¥ï¼Œå°±ä¼šå­˜æˆ.p12æ–‡ä»¶ï¼Œå…¶ä»–Macæ‰“å¼€åå°±å¯¼å…¥ç§é’¥ã€‚
ç¬¬4æ­¥éƒ½æ˜¯åœ¨è‹¹æœç½‘ç«™ä¸Šæ“ä½œï¼Œé…ç½®AppIDã€æƒé™ã€è®¾å¤‡ç­‰ï¼Œæœ€åä¸‹è½½ Provisioning Profileæ–‡ä»¶ã€‚
ç¬¬5æ­¥Xcodeä¼šé€šè¿‡ç¬¬3æ­¥ä¸‹è½½å›æ¥çš„è¯ä¹¦(å­˜ç€æœ¬åœ°å…¬é’¥)ï¼Œåœ¨æœ¬åœ°æ‰¾åˆ°å¯¹åº”çš„ç§é’¥(ç¬¬1æ­¥ç”Ÿæˆçš„)ï¼Œç”¨æœ¬åœ°ç§é’¥å»ç­¾åAppï¼Œå¹¶æŠŠProvisioning Profileæ–‡ä»¶å‘½åä¸ºembedded.mobileprovisionä¸€èµ·æ‰“åŒ…è¿›å»ã€‚è¿™é‡Œå¯¹Appçš„ç­¾åæ•°æ®ä¿å­˜åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼ŒMach-Oå¯æ‰§è¡Œæ–‡ä»¶ä¼šæŠŠç­¾åç›´æ¥å†™å…¥è¿™ä¸ªæ–‡ä»¶é‡Œï¼Œå…¶ä»–èµ„æºæ–‡ä»¶åˆ™ä¼šä¿å­˜åœ¨_CodeSignatureç›®å½•ä¸‹ã€‚
ç¬¬6ã€7æ­¥çš„æ‰“åŒ…å’ŒéªŒè¯éƒ½æ˜¯ Xcode å’Œ iOS ç³»ç»Ÿè‡ªåŠ¨åšçš„äº‹ã€‚

è¯ä¹¦ï¼šå†…å®¹æ˜¯å…¬é’¥æˆ–ç§é’¥ï¼Œç”±å…¶ä»–æœºæ„å¯¹å…¶ç­¾åç»„æˆçš„æ•°æ®åŒ…ã€‚
Entitlementsï¼šåŒ…å«äº†Appæƒé™å¼€å…³åˆ—è¡¨ã€‚
CertificateSigningRequestï¼šæœ¬åœ°å…¬é’¥ã€‚
.p12ï¼šæœ¬åœ°ç§é’¥ï¼Œå¯ä»¥å¯¼å…¥åˆ°å…¶ä»–ç”µè„‘ã€‚
Provisioning Profileï¼šåŒ…å«äº† è¯ä¹¦/Entitlements ç­‰æ•°æ®ï¼Œå¹¶ç”±è‹¹æœåå°ç§é’¥ç­¾åçš„æ•°æ®åŒ…ã€‚


```

-----
#### JSäº¤äº’
WKWebView  é»˜è®¤ä¸ä¼šæ‰“å¼€é“¾æ¥  éœ€è¦å®ç°æ–¹æ³•
```
-(void)webView:(WKWebView*)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler {
NSURL *URL = navigationAction.request.URL;
NSString *scheme = [URL scheme];
UIApplication *app = [UIApplication sharedApplication];
// æ‰“ç”µè¯
if ([scheme isEqualToString:@"tel"]) {
if ([app canOpenURL:URL]) {
[app openURL:URL];
// ä¸€å®šè¦åŠ ä¸Šè¿™å¥,å¦åˆ™ä¼šæ‰“å¼€æ–°é¡µé¢
decisionHandler(WKNavigationActionPolicyCancel);
return;
}
}
// æ‰“å¼€appstore
if ([URL.absoluteString containsString:@"ituns.apple.com"]) {
if ([app canOpenURL:URL]) {
[app openURL:URL];
decisionHandler(WKNavigationActionPolicyCancel);
return;
}
}
decisionHandler(WKNavigationActionPolicyAllow);
}

```

æ³¨æ„æœ€åçš„`decisionHandler(WKNavigationActionPolicyAllow); ` ï¼Œä¹‹å‰å› ä¸ºæ‹¬å·æ”¾é”™äº†ï¼Œç­‰äºæœ€åæœ‰æƒ…å†µæ²¡å®ç°è¿™ä¸ªhandleæ–¹æ³•ï¼Œå´©æºƒï¼Œä¸”æœ¨æœ‰ä¿¡æ¯â€¦â€¦

jsé»˜è®¤alertä¸å¼¹å‡º éœ€è¦å®ç°
```
- (void)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(void))completionHandler {

UIAlertController *alert = [UIAlertController alertControllerWithTitle:@"æé†’" message:message preferredStyle:UIAlertControllerStyleAlert];
[alert addAction:[UIAlertAction actionWithTitle:@"çŸ¥é“äº†" style:UIAlertActionStyleCancel handler:^(UIAlertAction * _Nonnull action) {
completionHandler();
}]];

[self presentViewController:alert animated:YES completion:nil];
}
```

jsäº¤äº’äº‹ä»¶
1. æ·»åŠ ç›‘å¬
``` 
viewWillAppear
[self.webView.configuration.userContentController addScriptMessageHandler:self name:@"gotoTel"];
```
2. ç›‘å¬æ–¹æ³•
```
- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message {

//    message.bobyå°±æ˜¯JSé‡Œä¼ è¿‡æ¥çš„å‚æ•°
NSLog(@"body:%@",message.body);
if ([message.name isEqual:@"gotoTel"]) {
if (self.repairPhoneData) {
self.repairPhoneData(message.body?((NSDictionary*)message.body):[NSDictionary dictionary]);
}

}
}
```

3. ç§»é™¤ç›‘å¬
```
- (void)dealloc {
[_webView.configuration.userContentController removeScriptMessageHandlerForName:@"gotoTel"];
}
```

è·å–æ ‡é¢˜
1. æ·»åŠ kvo
```
[self.webView addObserver:self forKeyPath:@"title" options:NSKeyValueObservingOptionNew context:NULL];
```
2. ä»£ç†äº‹ä»¶
```
#pragma mark KVOçš„ç›‘å¬ä»£ç†
- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context {

//ç½‘é¡µtitle
if ([keyPath isEqualToString:@"title"]) {
if (object == self.webView) {
self.title = self.webView.title;
} else {
[super observeValueForKeyPath:keyPath ofObject:object change:change context:context];
}
} else {
[super observeValueForKeyPath:keyPath ofObject:object change:change context:context];
}
}
```
3. ç§»é™¤ç›‘å¬
```
[_webView removeObserver:self forKeyPath:@"title"];
```


UIWebView
jsäº¤äº’
```
- (void)webViewDidFinishLoad:(UIWebView *)webView {
//    [Hub hideHUDQuery];

JSContext *jsContext = [webView valueForKeyPath:@"documentView.webView.mainFrame.javaScriptContext"];
jsContext.exceptionHandler = ^(JSContext *context, JSValue *exceptionValue) {
context.exception = exceptionValue;
NSLog(@"å¼‚å¸¸ä¿¡æ¯ï¼š%@", exceptionValue);
};
jsContext[@"gotoSafari"] = ^() {
NSArray *arguments = [JSContext currentArguments]; //è·å–ä»jsä¸­ä¼ å…¥çš„å‚æ•°ï¼›
//3.éå†
for (id arg in arguments) {
NSLog(@"%@", arg); //è¿™æ˜¯ä¼ å…¥çš„å‚æ•°
//æ­¤å¤„æ‰§è¡ŒOCä»£ç 
dispatch_async(dispatch_get_main_queue(), ^{
NSString *textURL = [NSString stringWithFormat:@"%@", arg];
NSURL *cleanURL = [NSURL URLWithString:textURL];
[[UIApplication sharedApplication] openURL:cleanURL];
});
}

};
}
```

è·å–æ ‡é¢˜
1. æ·»åŠ ç›‘å¬
```
 [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(webViewDidChange:) name:@"WebHistoryItemChangedNotification" object:nil];
```

2. æ·»åŠ æ–¹æ³•
```
- (void)webViewDidChange:(NSNotification *)notific {

NSString *htmlTitle = @"document.title";
NSString *titleHtmlInfo = [self.webView stringByEvaluatingJavaScriptFromString:htmlTitle];
if ([titleHtmlInfo stringByReplacingOccurrencesOfString:@" " withString:@""].length > 0) {
self.title = titleHtmlInfo;
}
}
```

3. ç§»é™¤ç›‘å¬
```
- (void)dealloc {

//ç§»é™¤è§‚å¯Ÿè€… self
[[NSNotificationCenter defaultCenter] removeObserver:self];
}
```

âš ï¸ åœ¨ä¸€ä¸ªä¿å•é¡µé¢ å‡ºç°äº†è¿”å›é¡µé¢å´©æºƒé—®é¢˜  
ä¸æç¤ºå´©æºƒé—®é¢˜ï¼Œæ ¹æ®å†…å®¹æ²¡æœåˆ°åŸå› 
```
2019-04-24 09:46:29.271626+0800 Engineer[858:13513] -[WebScriptObject _disconnectFrame]: unrecognized selector sent to instance 0x6000027b2c90
2019-04-24 09:46:29.278768+0800 Engineer[858:13513] *** Terminating app due to uncaught exception 'NSInvalidArgumentException', reason: '-[WebScriptObject _disconnectFrame]: unrecognized selector sent to instance 0x6000027b2c90'
*** First throw call stack:
(
0   CoreFoundation                      0x000000010b1026fb __exceptionPreprocess + 331
1   libobjc.A.dylib                     0x0000000109861ac5 objc_exception_throw + 48
2   CoreFoundation                      0x000000010b120ab4 -[NSObject(NSObject) doesNotRecognizeSelector:] + 132
3   CoreFoundation                      0x000000010b107443 ___forwarding___ + 1443
4   CoreFoundation                      0x000000010b109238 _CF_forwarding_prep_0 + 120
5   WebCore                             0x0000000116dadad7 _ZN7WebCore16ScriptControllerD2Ev + 23
6   WebCore                             0x00000001174b05b6 _ZN7WebCore5FrameD2Ev + 790
7   WebCore                             0x00000001174b086e _ZN7WebCore5FrameD0Ev + 14
8   WebCore                             0x00000001174d6d0f _ZN7WebCore4PageD2Ev + 3391
9   WebKitLegacy                        0x0000000115da8886 _ZN6WebKit22DeferredPageDestructor14tryDestructionEv + 118
10  WebKitLegacy                        0x0000000115d941cf __29-[WebView(WebPrivate) _close]_block_invoke + 431
11  WebCore                             0x0000000117691e16 _ZL15HandleRunSourcePv + 790
12  CoreFoundation                      0x000000010b069be1 __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 17
13  CoreFoundation                      0x000000010b069524 __CFRunLoopDoSources0 + 436
14  CoreFoundation                      0x000000010b063b1f __CFRunLoopRun + 1231
15  CoreFoundation                      0x000000010b063302 CFRunLoopRunSpecific + 626
16  WebCore                             0x00000001166aff55 _ZL12RunWebThreadPv + 565
17  libsystem_pthread.dylib             0x000000010cd502eb _pthread_body + 126
18  libsystem_pthread.dylib             0x000000010cd53249 _pthread_start + 66
19  libsystem_pthread.dylib             0x000000010cd4f40d thread_start + 13
)
libc++abi.dylib: terminating with uncaught exception of type NSException
```

ç»æµ‹è¯•ï¼Œç§»é™¤ç›‘å¬æ–¹æ³•èµ°äº†ã€‚åœ¨`webViewDidChange:`æ–¹æ³•ä¸­ï¼Œå†™äº† `stringByReplacingOccurrencesOfString` å°±ä¼šå´©æºƒï¼Œä¸å†™å°±ä¸ä¼šã€‚ä½†æ˜¯æ–­ç‚¹èµ°ä¸åˆ°å®ƒã€‚
æŸ¥åŸå› è¯´å› ä¸º`stringByReplacingOccurrencesOfString`æ–¹æ³•åªåœ¨ä¸»çº¿ç¨‹èµ°ï¼Œæ·»åŠ äº†diså›åˆ°ä¸»çº¿ç¨‹æ–¹æ³•ï¼Œæ— æ•ˆã€‚åå°è¯•å–æ¶ˆç›‘å¬æ–¹æ³•ï¼Œç”¨ç³»ç»Ÿæ–¹æ³•æ”¹å˜æ ‡é¢˜
```
-(BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType {
NSString *htmlTitle = @"document.title";
NSString *titleHtmlInfo = [self.webView stringByEvaluatingJavaScriptFromString:htmlTitle];
return YES;
}
```
æ·»åŠ ä¸Šè¿™ä¸ªæ–¹æ³•ç¨‹åºå°±ä¸å´©æºƒäº†ï¼ˆåŸå…ˆæœ‰shouldStartLoadWithRequestæ–¹æ³•ï¼Œåšçš„ä¸åŒäº‹ä»¶ï¼‰ã€‚æ·»åŠ äº†è¿™ä¸ªæ–¹æ³•ï¼Œç›‘å¬æ²¡æœ‰ç§»é™¤ ä½†æ˜¯ä¹Ÿæ²¡æœ‰å´©æºƒäº†ã€‚âš ï¸âš ï¸âš ï¸âš ï¸åŸå› æœªçŸ¥

-----

#### é¡µé¢background Fetch é€ æˆçš„é¡µé¢é—®é¢˜

åº”ç”¨ä¼šåœ¨åå°è¢«æ€æ­»åï¼Œå†æ¬¡æ‰“å¼€ï¼Œä¼šæœ‰ä¸€å †æç¤ºè¶…æ—¶ã€‚åœ¨ç¨‹åºåˆ‡æ¢æ—¶ï¼Œå±å¹•å¿«ç…§æ˜¾ç¤ºæç¤ºå‡ºé”™ã€‚åˆšæ‰“å¼€åº”ç”¨ï¼Œæ˜¾ç¤ºæ¥å£è¶…æ—¶ã€‚å‡ºç°å ä½å›¾ã€‚å¶ç°ã€‚åœ¨åº”ç”¨åœ¨åå°æŒ‚èµ·åˆ°æ€æ­»ï¼Œå†æ¬¡æ‰“å¼€ç¨‹åºå¶ç°ã€‚

åˆ†æåŸå› ï¼Œé¦–å…ˆæ˜¯è¦è§‚å¯Ÿåå°è¿è¡Œæƒ…å†µã€‚äºæ˜¯ä»¿ç…§ä¸Šä¼ æ•°æ®ç»Ÿè®¡mï¼Œå†™äº†ç»Ÿè®¡æ–¹æ³•è°ƒç”¨çš„ï¼Œè®©ä»–åœ¨è¿çº¿æµ‹è¯•æ˜¯æ‰“å°å‡ºæ¥ï¼Œé»˜è®¤çš„å­˜å‚¨åœ¨æœ¬åœ°ï¼Œç”±æ­¤æŸ¥çœ‹åå°è¿‡ç¨‹ã€‚

å‘ç°  åœ¨åå°è‡ªå·±è°ƒç”¨FinishLaunching æ–¹æ³•ï¼Œç”±æ­¤èµ°äº†é¦–é¡µçš„viewDidLoad å’Œ viewWillAppear ,è€Œåœ¨è¿™é‡Œé¢ï¼ŒåŸºæœ¬ä¸Šéƒ½æœ‰ç½‘ç»œè¯·æ±‚ç›¸å…³å†…å®¹ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨æ¥å£ï¼Œä½†æ˜¯ä¹‹åå°±è¢«å…³é—­ï¼Œé€ æˆæ¥å£è°ƒç”¨æœªå®Œæˆï¼Œåœ¨ä¸‹æ¬¡æ‰“å¼€appæ—¶ï¼Œé€ æˆè¶…æ—¶ã€‚

åŸä»¥ä¸ºè·Ÿæ¥å£è°ƒç”¨æœ‰å…³ï¼Œåæ¥å‘ç°æ˜¯ fetch é—®é¢˜ã€‚

    ```
    iOS 7 æ–°å¢åŠ çš„ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨äºå³ä½¿åœ¨åå°ï¼Œä¹Ÿéœ€è¦é¢‘ç¹æ›´æ–°æ•°æ®çš„åº”ç”¨ã€‚ä¾‹å¦‚ä¸€ä¸ª PM2.5 çš„åº”ç”¨ï¼Œéœ€è¦å‡ ä¸ªå°æ—¶æ›´æ–°ä¸€æ¬¡æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥å¼€å¯æ­¤é€‰é¡¹ï¼Œè®¾ç½®ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œä»è€Œè®© iOS åœ¨é—´éš”æ—¶é—´å†…åœ¨åå°å¯åŠ¨è¯¥åº”ç”¨ï¼Œæ‰§è¡ŒæŒ‡å®šæ•°æ®çš„è·å–å·¥ä½œï¼Œè€Œæ­¤è¿‡ç¨‹æœ€å¤šåªèƒ½æ‰§è¡Œ 30 ç§’é’Ÿã€‚
    
    åº”ç”¨ç¨‹åºå¯ä»¥ä»ç½‘ç»œä¸­æœ‰è§„å¾‹çš„ä¸‹è½½æ–°æ•°æ®ï¼›
    
    æ³¨å†Œæ–¹æ³•ä¸ºï¼šåœ¨ç¨‹åºçš„Info.plistä¸­ï¼Œå°†UIBackgroundModesé”®å€¼è®¾ç½®ä¸ºfetchï¼Œç„¶ååœ¨app delegateä¸­ï¼Œä½¿ç”¨æ–¹æ³•setMinimumBackgroundFetchInterval:æ¥è®¾ç½®ä¸‹è½½æ–°æ•°æ®æ“ä½œä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”ã€‚å¦å¤–ï¼Œå¿…é¡»åœ¨app delegateä¸­å®ç°application:performFetchWithCompletionHandler:æ–¹æ³•ä»¥æ‰§è¡Œä»»æ„çš„ä¸‹è½½ã€‚
    ```



    ```
    appæ²¡æœ‰è¿è¡Œ(ä¸åœ¨å‰å°ä¹Ÿä¸åœ¨åå°)ï¼Œè¢«Fetchäº‹ä»¶å”¤é†’æ‰§è¡Œ.è¿™ç§æƒ…å†µçš„æµ‹è¯•æ–¹æ³•å¦‚ä¸‹:
    
    Product->Scheme->Edit scheme åœ¨Debugæ¨¡å¼é€‰ä¸­Options,ç‚¹é€‰Launch due to a background fetch eventï¼Œè¿è¡Œå³å¯ã€‚
    å¯ä»¥è§‚å¯Ÿåˆ°å½“Fetchäº‹ä»¶åˆ°æ¥æ—¶ï¼Œappå…ˆè¿›å…¥åå°ï¼Œå†æ‰§è¡Œ- (void)application:(UIApplication *)application performFetchWithCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler{}ã€‚
ã€€ã€€```


åœ¨xcodeè°ƒè¯•ï¼Œå‘ç°å¯åŠ¨fetchäº‹ä»¶ï¼Œè·Ÿæ‰“å°äº‹ä»¶ä¸€æ ·ã€‚


    æ­£å¸¸
    â˜€ï¸START
    2019-06-11 16:41:46,â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸FinishLaunchingğŸ§¸ğŸ§¸ğŸ§¸
    
    2019-06-11 16:41:47,ğŸ–ŒğŸ–ŒğŸ–ŒğŸ–ŒğŸ–ŒğŸ–Œ Home_RootViewController - viewDidLoad
    2019-06-11 16:41:47,ğŸ–ŒğŸ–ŒğŸ–ŒğŸ–ŒğŸ–ŒğŸ–Œ Home_RootViewController - viewWillAppear
    2019-06-11 16:41:48,ğŸ“’ğŸ“’ğŸ“’ğŸ“’ğŸ“’didRegisterForRemoteNotificationsWithDeviceToken
    2019-06-11 16:41:48,ğŸ“’ğŸ“’ğŸ“’ğŸ“’ğŸ“’didRegisterForRemoteNotificationsWithDeviceToken
    2019-06-11 16:41:48,ğŸ“’ğŸ“’ğŸ“’ğŸ“’ğŸ“’didRegisterForRemoteNotificationsWithDeviceToken
    2019-06-11 16:41:48,â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸BecomeActiveğŸ­ğŸ­ğŸ­
    
    2019-06-11 16:41:50,â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸â˜”ï¸ResignActiveğŸ™ŠğŸ™ŠğŸ™Š 
    2019-06-11 16:41:51,ğŸ“’ğŸ“’ğŸ“’ğŸ“’ğŸ“’applicationDidEnterBackground
    æ¨¡æ‹Ÿå™¨èµ°fetch
    â˜€ï¸START
    2019-06-11 16:58:13,â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸FinishLaunchingğŸ§¸ğŸ§¸ğŸ§¸
    
    2019-06-11 16:58:14,ğŸ“’ğŸ“’ğŸ“’ğŸ“’ğŸ“’performFetchWithCompletionHandler
    
    2019-06-11 16:58:14,ğŸ–ŒğŸ–ŒğŸ–ŒğŸ–ŒğŸ–ŒğŸ–Œ Home_RootViewController - viewDidLoad
    2019-06-11 16:58:14,ğŸ–ŒğŸ–ŒğŸ–ŒğŸ–ŒğŸ–ŒğŸ–Œ Home_RootViewController - viewWillAppear

fetchæœ€å¤šè°ƒç”¨30s ä½†æˆ‘çš„ performFetchWithCompletionHandler äº‹ä»¶é‡Œé¢ ç›´æ¥å†™äº† completionHandler é€ æˆèµ°äº†finishLaunching,ä½†æ˜¯äº‹ä»¶è¢«æˆªæ–­äº†ï¼Œæœ‰è¯·æ±‚ä¹Ÿæ²¡æœ‰ç»§ç»­æ‰§è¡Œã€‚æ‰€ä»¥é€ æˆå†æ‰“å¼€è¶…æ—¶ã€‚

å› æ­¤åœ¨ completionHandler äº‹ä»¶é‡Œé¢ æ·»åŠ äº†å»¶è¿Ÿ20sè°ƒç”¨ï¼Œç”¨åšç»™æ¥å£çš„æ—¶é—´ã€‚å®Œæˆã€‚

[ç›¸å…³æ–‡ç« ](https://www.jianshu.com/p/82f639012f3e)

ç»æµ‹è¯• ç›´æ¥è°ƒç”¨ä¹Ÿä¼šç»™30sæ—¶é—´å¤„ç†

```
#pragma mark åå°åˆ·æ–°æ•°æ®ç•Œé¢å›è°ƒ
-(void)application:(UIApplication *)application performFetchWithCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler {

NSLog(@"ğŸ¤š=============performFetchWithCompletionHandlerå›è°ƒ");
dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
[WebLoadRecod writefile:@"ğŸ’™ğŸ’™ğŸ’™ğŸ’™å¤±è´¥åçš„3s"];
});
dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(5 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
[WebLoadRecod writefile:@"ğŸ§¡ğŸ§¡ğŸ§¡ğŸ§¡å¤±è´¥åçš„5s"];
});
dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(10 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
[WebLoadRecod writefile:@"â£ï¸â£ï¸â£ï¸â£ï¸â£ï¸å¤±è´¥åçš„10s"];
});
dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(20 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
[WebLoadRecod writefile:@"ğŸ’šğŸ’šğŸ’šğŸ’šå¤±è´¥åçš„20s"];
});
dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(29 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
[WebLoadRecod writefile:@"ğŸ’œğŸ’œğŸ’œğŸ’œå¤±è´¥åçš„29s"];
});
//Tell the system that you ar done.
completionHandler(UIBackgroundFetchResultFailed);
}

```

è¿™ä¸ªå…¨éƒ¨éƒ½ä¼šæ‰“å°ï¼Œè€Œä¸”ä¹Ÿæ›´æ–°çš„uiã€‚


æ ¹æ®å•ç‹¬è°ƒç”¨background Fetchäº‹ä»¶ï¼Œ æœ€åçš„completionHandleräº‹ä»¶æ˜¯ç»“æŸäº‹ä»¶ã€‚åŠ å»¶æ—¶çš„è¯ï¼Œä¼šèµ°åé¢çš„â€œå¤±è´¥åçš„xç§’â€æç¤ºï¼Œèµ°å®Œä¹‹åå°±ä¸ä¼šæç¤ºäº†ã€‚ï¼ˆç»™completionHandlerå»¶æ—¶21s,èƒ½æ‰“å°åˆ°20sæç¤º,ä½†ä¸ä¼šæ‰“å°29sæç¤ºï¼‰

å»¶æ—¶å‰
```
=============performFetchWithCompletionHandlerå›è°ƒ
2019-06-13 15:25:30.938730+0800 Engineer[32963:228041] WARNING: URLSession (or NSURLConnection) is using SPDY protocol, which is deprecated and will be removed in a future release
2019-06-13 15:25:30.984128+0800 Engineer[32963:227971] [ğŸ””å‡½æ•°å:-[DemandListViewController filterView]] [ğŸŒ·è¡Œå·:289]:
_filterView.shadowY == 191.000000
2019-06-13 15:25:31.083068+0800 Engineer[32963:227971] [ğŸ””å‡½æ•°å:+[WebAPIClient getJSONWithUrl:parameters:success:fail:showHub:hubString:]_block_invoke_2] [ğŸŒ·è¡Œå·:90]:
ğŸ¸âœ…Request:Succcess, [GET]URL:http://10.60.1.222:8080/server/version/userVersionInfo, para:{

2019-06-13 15:25:31.112134+0800 Engineer[32963:227971] ğŸ¦[XGDemo] Push Is ON
2019-06-13 15:25:31.120015+0800 Engineer[32963:227971] [ğŸ””å‡½æ•°å:+[WebAPIClient getJSONWithUrl:parameters:success:fail:showHub:hubString:]_block_invoke_2] [ğŸŒ·è¡Œå·:90]:
ğŸ¸âœ…Request:Succcess, [GET]URL:http://10.60.1.222:8080/bannerController/v3/url, para:(null)

2019-06-13 15:25:31.129888+0800 Engineer[32963:227971] [ğŸ””å‡½æ•°å:+[WebAPIClient getJSONWithUrl:parameters:success:fail:showHub:hubString:]_block_invoke_2] [ğŸŒ·è¡Œå·:90]:
ğŸ¸âœ…Request:Succcess, [GET]URL:http://10.60.1.222:8080/server/V3/extension/mainExtension, para:

```

å»¶æ—¶å
```
ğŸ¤š=============performFetchWithCompletionHandlerå›è°ƒ
2019-06-13 15:26:49.207167+0800 Engineer[32996:229491] WARNING: URLSession (or NSURLConnection) is using SPDY protocol, which is deprecated and will be removed in a future release
2019-06-13 15:26:49.263650+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:-[DemandListViewController filterView]] [ğŸŒ·è¡Œå·:289]:
_filterView.shadowY == 191.000000
2019-06-13 15:26:49.354004+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:+[WebAPIClient getJSONWithUrl:parameters:success:fail:showHub:hubString:]_block_invoke_2] [ğŸŒ·è¡Œå·:90]:
ğŸ¸âœ…Request:Succcess, [GET]URL:http://10.60.1.222:8080/server/version/userVersionInfo, para:{
2019-06-13 15:26:49.359605+0800 Engineer[32996:229382] ğŸ¦[XGDemo] Push Is ON
2019-06-13 15:26:49.375720+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:+[WebAPIClient getJSONWithUrl:parameters:success:fail:showHub:hubString:]_block_invoke_2] [ğŸŒ·è¡Œå·:90]:
ğŸ¸âœ…Request:Succcess, [GET]URL:http://10.60.1.222:8080/bannerController/v3/url, 
2019-06-13 15:26:49.439700+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:+[WebAPIClient getJSONWithUrl:parameters:success:fail:showHub:hubString:]_block_invoke_2] [ğŸŒ·è¡Œå·:90]:
ğŸ¸âœ…Request:Succcess, [GET]URL:http://10.60.1.222:8080/server/V3/extension/mainExtension, para:{

2019-06-13 15:26:49.609336+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:+[WebAPIClient postJSONWithUrl:parameters:success:fail:showHub:hubString:]_block_invoke] [ğŸŒ·è¡Œå·:195]:
ğŸ¸âœ…Request:Succcess, [POST]URL:http://10.60.1.222:8080/v3/SpinnerController/directionVo,para:(null)

2019-06-13 15:26:49.841544+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:-[DemandListViewController loadWebData]] [ğŸŒ·è¡Œå·:138]:
typeCode == (null)
2019-06-13 15:26:49.842019+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:-[DemandListViewController loadWebData]] [ğŸŒ·è¡Œå·:139]:
typeDirection == (null)
2019-06-13 15:26:49.842549+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:-[DemandListViewController loadWebData]] [ğŸŒ·è¡Œå·:140]:

2019-06-13 15:26:50.205034+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:-[AppDelegate changeTestIcon]_block_invoke_3] [ğŸŒ·è¡Œå·:661]:
å¤±è´¥
2019-06-13 15:26:50.342208+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:+[WebAPIClient postJSONWithUrl:parameters:success:fail:showHub:hubString:]_block_invoke] [ğŸŒ·è¡Œå·:195]:
ğŸ¸âœ…Request:Succcess, [POST]URL:http://10.60.1.222:8080/v3/ticket/all?pageIndex=0&pageSize=10,para:{

2019-06-13 15:26:52.175778+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:-[AppDelegate application:performFetchWithCompletionHandler:]_block_invoke] [ğŸŒ·è¡Œå·:264]:
ğŸ’™ğŸ’™ğŸ’™ğŸ’™å¤±è´¥åçš„3s
2019-06-13 15:26:54.638200+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:-[AppDelegate application:performFetchWithCompletionHandler:]_block_invoke_2] [ğŸŒ·è¡Œå·:268]:
ğŸ§¡ğŸ§¡ğŸ§¡ğŸ§¡å¤±è´¥åçš„5s
2019-06-13 15:26:59.152615+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:-[AppDelegate application:performFetchWithCompletionHandler:]_block_invoke_3] [ğŸŒ·è¡Œå·:272]:
â£ï¸â£ï¸â£ï¸â£ï¸å¤±è´¥åçš„10s
2019-06-13 15:27:10.170018+0800 Engineer[32996:229382] [ğŸ””å‡½æ•°å:-[AppDelegate application:performFetchWithCompletionHandler:]_block_invoke_4] [ğŸŒ·è¡Œå·:276]:
ğŸ’šğŸ’šğŸ’šğŸ’šå¤±è´¥åçš„20s
```

-----

#### é¦–æ¬¡ç‚¹å‡»èŠå¤©é¡µé¢ç¼“æ…¢

ä¹‹å‰æœ‰ä¸ªéœ€æ±‚ï¼ŒæŠŠèŠå¤©ç‹¬ç«‹å‡ºæ¥ï¼Œç”±å­ç±»å®ç°æ–¹æ³•é‡å†™æ¥ç‹¬ç«‹çˆ¶ç±»ï¼Œä½¿åŒ…å¯ä»¥æ›¿æ¢ã€‚

å­ç±»ç»§æ‰¿ä¸æ˜¯å¾ˆå¥½çš„è§£è—•æ–¹æ³•ï¼Œå› ä¸ºçˆ¶ç±»æ–¹æ³•åå˜äº†ï¼Œä¼šé€ æˆå­ç±»ä¹Ÿä¼šå˜ã€‚ä½†æ˜¯é’ˆå¯¹èŠå¤©ï¼Œæš‚æ—¶æ²¡æœ‰æ›´å¥½çš„åŠæ³•ã€‚å¯ä»¥è‡ªå·±ä¿®æ”¹å®šåˆ¶ä¸€å¥—è‡ªå·±çš„uiï¼Œå°±ä¸åŠ¨äº†ï¼Œä½†æ˜¯æ€•ä»–ä»¬çš„æ–¹æ³•å¢åŠ ï¼Œå› æ­¤æš‚æ—¶ä¸è€ƒè™‘ã€‚

å­ç±»é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œé‡‡ç”¨å°½é‡superï¼Œå› ä¸ºä¸€ç›´çˆ¶ç±»æ–¹æ³•åç§°åŠå®ç°ï¼Œæ‰€ä»¥ç”¨  extention æ¥å®ç°å…¬å¼€çˆ¶ç±»æ–¹æ³•ã€‚ï¼ˆæ³¨ï¼šæ­¤æ–¹æ³•åœ¨å·²çŸ¥çˆ¶ç±»æ–¹æ³•åæ—¶ç”¨ï¼Œè¦è°¨æ…ï¼Œå¦‚æœ.mé‡Œæ–¹æ³•æ²¡å®ç°ï¼Œåˆ™ä¼šå´©æºƒï¼‰

é‡å†™ä¹Ÿé€ æˆä¸€å®šçš„æ€§èƒ½æµªè´¹ï¼šæ¯”å¦‚é‡å†™åœ¨åŸæ–¹æ³•ä¹‹åï¼Œä¼šé€ æˆå…ˆåˆå§‹åŒ–ä¸€éä¹‹å‰çš„ï¼Œåœ¨åˆå§‹åŒ–ä¹‹åçš„ï¼Œå…¶å®æ²¡å¿…è¦ã€‚



é‡åˆ°çš„é—®é¢˜æ˜¯ï¼Œç¬¬ä¸€æ¬¡ç‚¹å‡»åˆ°èŠå¤©è¯¦æƒ…é¡µé¢æ—¶ï¼ŒåŠ è½½ç¼“æ…¢ã€‚

ç”¨timer profile æŸ¥è¯¢é—®é¢˜



![time profile](http://ww3.sinaimg.cn/large/006tNc79ly1g3yi2qj0i8j311k0u0aho.jpg)



å‘ç°è¾ƒå¤šæ—¶uiimageçš„é—®é¢˜ã€‚åŠ è½½å›¾ç‰‡è€—æ—¶ã€‚

è€Œè¿™äº›å›¾ç‰‡ï¼Œæ˜¯åŸé¡µé¢çš„å›¾ç‰‡ï¼Œå°±æ˜¯åŠ è½½bundelå†…å›¾ç‰‡æœ‰é—®é¢˜ã€‚è€Œbundel æ˜¯åŸæ¥ç³»ç»Ÿå›¾ç‰‡ ç°åœ¨ä¹Ÿç”¨ä¸åˆ°äº†ã€‚éƒ½æœ‰è‡ªå·±çš„å›¾ç‰‡æ›¿æ¢ï¼Œæ‰€ä»¥è§£å†³åŠæ³•æ˜¯æŠŠå›¾ç‰‡ç§»é™¤ï¼ˆä¹Ÿå‡å°åŒ…ä½“ç§¯ï¼‰ã€‚è¿è¡Œå‘ç°æœ‰ä¸€ä¸ªå›¾ç‰‡æ•°ç»„ï¼ŒåŠ è½½ä¸€ç»„å›¾ç‰‡ï¼Œä¼šå› æ’å…¥nilå´©æºƒï¼Œæ‰€ä»¥æŠŠé‚£å¥æ³¨è¯•æ‰ï¼Œå¹¶å†™å¥½æ›´æ–°å¤‡æ³¨ã€‚

-----

#### ç»Ÿè®¡ä»£ç è¡Œæ•°

å»ç©ºè¡Œ
` find . -name "*.m" -or -name "*.h" -or -name "*.xib" -or -name "*.c" |xargs grep -v "^$"|wc -l `

æŸ¥çœ‹æ–‡ä»¶ä¸ªæ•°
`ls -lR| grep "^-" | wc -l` 

-----

#### pod åˆ›å»ºTests,UITestsæ–‡ä»¶

éœ€è¦åœ¨podFileé‡Œé¢å¾ªç¯åˆ›å»º
```
platform :ios, '8.0'
targetsArray = ['User', 'UserUITests', 'UserTests']
#target â€œUserâ€ do
targetsArray.each do |t|
    target t do
        pod someThing
        .....
        
    end
end

```



ä¹‹åæ–‡ä»¶é‡Œä¼šå‡ºç°xcconfigæ–‡ä»¶

![1565006158101](http://ww2.sinaimg.cn/large/006tNc79ly1g5p1voba5fj30i80uoadf.jpg)



ç›¸åº”targetsé‡Œé¢ä¹Ÿä¼šå‡ºç°config.file

![1565006211057](http://ww4.sinaimg.cn/large/006tNc79ly1g5p1w7wm77j314m0u0ajj.jpg)



testé‡Œé¢  ` $(inherited)`  ä¹Ÿä¼šæœ‰å†…å®¹å•¦ å¦åˆ™åœ¨testé‡Œé¢æ˜¯ç©ºçš„

-----

#### tests 

```
â€œæœªèƒ½å®‰è£…åº”ç”¨ï¼Œå› ä¸ºå®ƒå·²æŸåæˆ–ç¼ºå°‘å¿…è¦çš„èµ„æºã€‚â€  ==> ä¿®æ”¹Targets-Tests-General-HostApplication
ç¼ºå°‘æ–‡ä»¶ ï¼Œpodséœ€è¦è®¾ç½®testsçš„targetçš„å†…å®¹ï¼ŒåŒä¸Š
```


```
tests-BuildPhasesé‡Œé¢æ·»åŠ æ–‡ä»¶ï¼šå¯ä»¥é€‰æ‹©æ–‡ä»¶-è¾¹æ TaegetMembershipæ‰“å‹¾æ·»åŠ ï¼Œä¹Ÿå¯ä»¥åœ¨BuildPhasesé‡Œç‚¹å‡»addæ‰¹é‡æ·»åŠ ï¼ˆå¿«å¾—å¤šï¼Œä½†è¦æ³¨æ„testsé‡Œé¢è¦ç§»é™¤uitests.mæ–‡ä»¶ï¼‰
```

```
â€œæœªèƒ½è½½å…¥è½¯ä»¶åŒ…â€œUserUITestsâ€ã€‚ è¯·å°è¯•é‡æ–°å®‰è£…è½¯ä»¶åŒ…ã€‚â€ ==>  è¿˜æ˜¯æ–‡ä»¶çš„é“¾æ¥æ–‡ä»¶çš„é—®é¢˜ã€ã€
æŠŠBundleLoaderæ”¹ä¸ºè·ŸTestsä¸€æ ·çš„@ï¼ˆTest_Hostï¼‰
ã€ä½†æ˜¯æµ‹è¯•é‡Œé¢æœ‰Test_Hostå±æ€§ï¼ŒUITestæ²¡æœ‰ï¼Œä¹‹å‰è®¤ä¸ºåº”æ·»åŠ Test_Host å°±æŠŠå®ƒçš„å†…å®¹çš„åœ°å€èµ‹å€¼è¿‡å»äº†ï¼Œç°åœ¨æ„Ÿè§‰æ˜¯å› ä¸ºè¿™ä¸ªåœ°å€æ‰€ä»¥bundleçš„åŒ…ã€frameWorkçš„åŒ…çš„è·¯å¾„ä¸å¯¹ï¼Œæ‰€ä»¥èƒ½ç¼–è¯‘ä¸èƒ½è¿è¡Œã€‘ã€‚
ä¿®æ”¹äº†Test_Hoståï¼Œè¿è¡Œå¼€å§‹æŠ¥é”™ï¼Œç¼ºå°‘alipay.frameworktï¼Œæ·»åŠ åä»æŠ¥é”™ï¼Œç¼ºå°‘CMMotionManager in AlipaySDKï¼Œæ‰€ä»¥å¯¹ç…§æ·»åŠ äº†æ‰€æœ‰çš„åŒ…ï¼Œè¿è¡ŒæˆåŠŸã€‚ã€ä¸€æŠŠè¾›é…¸æ³ªâ€¦â€¦æä¸å®šäº†æ”¾ä¸€æ®µä¹Ÿå¥½â€¦â€¦è¯´ä¸å®šå•¥æ—¶å€™å°±è§£å†³äº†â€¦â€¦ã€‘
```



```
	è¿è¡Œå·¥ç¨‹å¸ˆçš„unit Testsçš„æ—¶å€™ï¼Œæ€»ä¼šå´©æºƒåœ¨åœ°å›¾å¼€å¯çš„åœ°æ–¹ï¼ŒæŠ¥é”™ â€œInvalid parameter not satisfying: !stayUp || CLClientIsBackgroundable(internal->fClient)â€ 
	ç™¾åº¦æŸ¥åˆ°çš„æ˜¯éœ€è¦åœ¨infoé‡Œé¢æ·»åŠ backgroundè¿è¡Œçš„è®¸å¯å†…å®¹ï¼Œä½†æ˜¯æµ‹è¯•æ²¡æœ‰è¿™ä¸ªã€‚
	æµ‹è¯•åœ¨infoé‡Œé¢æ·»åŠ /åˆ é™¤ è®¸å¯/æç¤ºç­‰ éƒ½æ²¡æœ‰ç”¨
	åˆ°å¤„æœä¸åˆ°â€¦â€¦ åˆåœäº†å¥½ä¹…â€¦â€¦ ç„¶åè¯•äº†è¯•â€¦â€¦æŠŠappä¸Šçš„é¡¹ç›®ç»™åˆ äº†â€¦â€¦ ä¸¥æ ¼æ¥è¯´æ˜¯å§EngineerUITestsæ–‡ä»¶ç»™åˆ äº†â€¦â€¦ ç„¶åå¯ä»¥äº†è¿è¡ŒæˆåŠŸäº†â€¦â€¦ ã€æˆ‘ä¹Ÿæ²¡æ³•è·Ÿä½ è§£é‡Š  å› ä¸ºæˆ‘æ˜¯ä¸€åªå°ç™½å…”â€¦â€¦ã€‘
```

-----


#### UITestsç›¸å…³é—®é¢˜å•Š

1. UITests ä¸èƒ½è®¿é—®åŸæœ‰APPçš„ä»»ä½•å˜é‡,æ‰€ä»¥åªèƒ½é€šè¿‡æŸä¸ªç•Œé¢ç‰¹æœ‰çš„å…ƒç´ `Element` æ¥è¿›è¡Œåˆ¤æ–­ã€‚æ¯æ¬¡è¿è¡Œä¸€ä¸ªæ–‡ä»¶éœ€è¦æœ‰ `setUp` é‡Œé¢çš„` launch` æ‰èƒ½å¯åŠ¨ï¼Œå¯ä»¥è®¾ç½®é€šç”¨å˜é‡ï¼ˆå¦‚ç™»å½•è´¦å·ç­‰ï¼‰ï¼Œä½†å¦‚æœåœ¨`setUp`é‡Œé¢è®¾ç½®çš„è¯ï¼Œè™½ç„¶æ˜¯å…¨å±€çš„ï¼Œä½†æ˜¯ä¸€ä¸ªæ–‡ä»¶é‡Œé¢çš„ä¸åŒæµ‹è¯•ç”¨ä¾‹ï¼Œéƒ½æ˜¯ä»`setUp`é‡Œé¢å–çš„åˆè¯•å€¼ã€‚å‰é¢çš„æµ‹è¯•ç”¨ä¾‹è°ƒç”¨äº†`renewPhoneNumber`åé‡ç½®äº†æµ‹æ‰‹æœºå·ï¼Œåˆ°ä¸‹ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹è¿˜ä¼šå»`setUp`é‡Œé¢çš„å€¼ï¼Œè€Œä¸æ˜¯åˆšæ‰`renew`çš„ã€‚**ç­‰äºé‡æ–°å¼€å§‹çš„**ã€‚

2. å¯ä»¥æ·»åŠ baseæ–‡ä»¶å•Šï¼Œåˆ›å»ºåŸºäº`XCTestCase`çš„`UITests` æ–‡ä»¶ï¼Œç„¶ååˆ›å»º `.h` æ–‡ä»¶,æŠŠ `@interface` æ‹¿è¿‡å»ï¼Œç„¶åå¯ä»¥è®¾ç½®å…¬ç”¨æ–¹æ³•ï¼Œä¾‹å¦‚å­—æ®µåˆ¤æ–­ï¼Œæˆ–è€…ç™»å½•ä»€ä¹ˆçš„ï¼Œå…¶ä»–æµ‹è¯•æ–‡ä»¶å°±èƒ½å¼•ç”¨äº†ã€‚

3. æ‰¾ä¸åˆ°å…ƒç´  - â€œ[Timestamped Event Matching Error: Failed to find matching element](https://stackoverflow.com/questions/36597862/xcode-timestamped-event-matching-error-failed-to-find-matching-element)â€ ï¼Œè®¾ç½®`isAccessibilityElement`, æ·»åŠ ç›¸åº”çš„  `accessibilityIdentifier`. è¿™ä¸ªå±æ€§æ˜¯é»˜è®¤æ˜¯`no`çš„ï¼Œå¦‚æœåœ¨xibé‡Œé¢ï¼Œåœ¨ä¾§è¾¹æ è®¾ç½®æ‰“å‹¾å’Œidã€‚

    ä½†æ˜¯ä¸æ˜¯éƒ½åŠ ä¸Šéƒ½å¥½ï¼Œä¾‹å¦‚åœ¨`NSObjectçš„åˆ†ç±»`é‡Œé¢æ·»åŠ äº†setæ–¹æ³•ï¼ˆæ˜¯çœ‹`TTTAttributedLabel`è¿™æ ·å†™çš„ï¼Œäººå®¶æ˜¯è®¾ä¸ºnoçš„ï¼‰

   ```
   - (BOOL)isAccessibilityElement {
       return YES;//NO;
   }
   ```

   ç„¶åå¦‚æœç»Ÿä¸€è®¾ç½®ä¸º`YES`, åˆ™ä¼šç‚¹å‡»å•¥éƒ½æ˜¾ç¤ºçš„ç‚¹å‡»`window`ï¼Œå…¶ä»–å…ƒç´ å°±éƒ½è®°å½•ä¸äº†äº†ã€‚æ ¹æ®è¿™ä¸ªæ‰çŸ¥é“ä¸èƒ½éƒ½è®¾ç½®ã€‚

   ä¾‹å¦‚ï¼šå®¢æˆ·ç«¯å‘å•é¡µé¢ï¼Œç‚¹å‡»ä¸€è¡Œå¼¹å‡ºä¸€ä¸ª`view`(åœ¨`self.view`ä¸Š)ï¼Œç„¶åviewä¸€åŠä¸€ä¸ª`tableView`,é€‰æ‹©æŸé¡¹æ”¶å›èµ‹å€¼ã€‚åˆå§‹æ ¹æ®å°ç§¦å†™çš„ï¼Œç»™`view`è®¾ç½®å¯è¾…åŠ©ï¼Œè®¾ç½®ä¸€ä¸ª`id`,ç„¶åå†ç»™`tableView`è®¾ç½®å¯è¾…åŠ©ï¼Œè®¾ç½®ä¸€ä¸ª`id`ã€‚ç„¶åè·å–é¡µé¢å…ƒç´ ï¼Œç›´æ¥è·å– `app.tableView`,åªæœ‰ä¸€ä¸ªï¼Œåœ¨ `app.otherElement`é‡Œé¢æœ‰`view`,èƒ½æ‰¾åˆ°`view`çš„`id`,è·å–åˆ°è¿™ä¸ªå…ƒç´ ä¹‹åï¼Œ`view.tables/cells/otherElement`ç­‰éƒ½**æ²¡æœ‰å€¼**,æˆ–è€…å–cellçš„æ—¶å€™å½•å±æœ‰ä¸€ä¸ª`nå¤šå±‚çš„otherElement  tap` ,ç›´æ¥è¿è¡Œè‚¯å®šä¸å¯¹ã€‚æ‰¾ä¸åˆ°`tableView` çš„å†…å®¹ã€‚åæ¥å§`view`çš„`id`å’Œå±æ€§å…³é—­ï¼Œç”¨`app.tables`å¯ä»¥æ‰¾åˆ°å†…å®¹äº†ã€‚æ‰€ä»¥**è¦é€‚å½“ï¼Œç”¨åˆ°çš„è®¾ç½®**ã€‚

4. `tableView`çš„åµŒå¥—ï¼Œä¼šå–åˆ°åµŒå¥—é‡Œé¢çš„`cell`ã€‚

   ç›´æ¥ `orderTable.cell` ä¼šå–åˆ° åŸ`orderTableçš„cell+å®æ–½é‡Œé¢åµŒå¥—çš„cell`ã€‚æ’åºå°±æ˜¯**åŸç”Ÿ+åµŒå¥—**ï¼Œæ‰€ä»¥æŒ‰é¡ºåºæ‰¾`cell`åˆ¤æ–­çš„æ—¶å€™éœ€è¦æ³¨æ„ã€‚

   åµŒå¥—çš„`cell`å¯ä»¥å•ç‹¬å–åˆ°ï¼š

   ```objective-c
    XCUIElement *implementCell = [orderTableView.cells containingType:XCUIElementTypeStaticText identifier:@"å®æ–½è¿›åº¦"].element;//å–å®æ–½cell
   XCUIElement *impleTable = implementCell.tables.firstMatch;//å–åµŒå¥—è¿›å»çš„table
   impleTable.cells åµŒå¥—çš„cellçš„é›†åˆã€‚
   ```

5. æ­£åˆ™åˆ¤æ–­å†…å®¹

   ```objective-c
    		NSString *format = [NSString stringWithFormat:@"label 1âƒ£ï¸ contains '%@' 2âƒ£ï¸", @"ç­¾åˆ°åœ°å€:"];//å†™æ­£åˆ™format
       NSPredicate *preset = [NSPredicate predicateWithFormat:format /*3âƒ£ï¸*/];//æ·»åŠ NSPredicate
       XCUIElement *element = [app.tables.staticTexts /*4âƒ£ï¸*/ elementMatchingPredicate:preset];//å–element
       
    		XCTAssert(element.exists5âƒ£ï¸, @"ç­¾åˆ°åœ°å€æ˜¾ç¤º");
   ```

   âš ï¸   1âƒ£ï¸2âƒ£ï¸ `format`å†™æ³•ï¼Œæ–‡å­—çš„è¯æ˜¯ `label  contains  '%@'` æ³¨æ„ `label/å¼•å·` ,3âƒ£ï¸æ­£åˆ™çš„`forma`tåé¢æ˜¯ä¸€ä¸ª`string`, ` [NSPredicate predicateWithFormat:@"label contains '%@'", @"ç­¾åˆ°åœ°å€:"]` è¿™æ ·å†™åˆ°`exist`è¿è¡ŒæŠ¥é”™ã€‚4âƒ£ï¸ `matchin`å‰é¢æ˜¯`.staticTexts`ã€‚5âƒ£ï¸ `exists`åˆ¤æ–­å­˜åœ¨

   

   ç›¸å…³çš„åˆ¤æ–­-i71æ‘˜å½•

   ```objective-c
   - (XCUIElement *)elementWith:(NSString *)text {
       return self.app.staticTexts[text];
   }
   
   - (XCUIElement *)elementWithPrefix:(NSString *)prefix {
       NSString *format = [NSString stringWithFormat:@"label beginswith '%@'", prefix];
       return [self staticTextElementWithPredicateFormat:format];
   }
   
   - (XCUIElement *)elementWithContains:(NSString *)content {
       NSString *format = [NSString stringWithFormat:@"label contains '%@'", content];
       return [self staticTextElementWithPredicateFormat:format];
   }
   
   - (XCUIElement *)staticTextElementWithPredicateFormat:(NSString *)format {
       NSPredicate *predicate = [NSPredicate predicateWithFormat:format];
       XCUIElement *element = [self.app.staticTexts elementMatchingPredicate:predicate];
       return element;
   }
   
   - (void)expectObjectExist:(nullable id)object description:(NSString *)desc timeout:(NSTimeInterval)seconds {
       [self expectationWithPredicate:@"exists == 1" evaluatedObject:object description:desc timeout:seconds];
       [self expectationWithPredicate:@"hittable == 1" evaluatedObject:object description:desc timeout:seconds];
   }
   
   - (void)expectObjectNotExist:(nullable id)object description:(NSString *)desc timeout:(NSTimeInterval)seconds {
       [self expectationWithPredicate:@"exists == 0" evaluatedObject:object description:desc timeout:seconds];
   }
   
   // descä¸èƒ½ä¸ºnilï¼Œå¦åˆ™ä¼šåŠŸèƒ½ä¸æ­£å¸¸ï¼Œwhyï¼Ÿå¯ä»¥ä¼ ç©ºå­—ç¬¦ä¸²
   - (void)expectationWithPredicate:(NSString *)predicateStr
                    evaluatedObject:(nullable id)object
                        description:(NSString *)desc
                            timeout:(NSTimeInterval)seconds {
       NSPredicate *predicate = [NSPredicate predicateWithFormat:predicateStr];
       XCTestExpectation *expectation = [self expectationForPredicate:predicate evaluatedWithObject:object handler:nil];
       expectation.expectationDescription = desc;
       [self waitForExpectations:@[expectation] timeout:seconds];
   }
   ```

6. å¾ªç¯æ‰¾cell -- ä¸æ˜¯æœ€ä¼˜ å¾…ä¼˜åŒ–

   ```objective-c
   //é¦–é¡µæ»‘åŠ¨ 
       XCUIElement *tableView = app.scrollViews.otherElements.tables[@"demandListTable"];
       
       //ç‚¹å‡»cell 	1âƒ£ï¸
       XCUIElementQuery *qure = [tableView.cells containingType:XCUIElementTypeStaticText identifier:@"ticketType"];
       
       DebugLog(@"%lu",(unsigned long)qure.count);
       
       //å¦‚æœæ²¡æœ‰å¾ªç¯æ»‘åŠ¨ï½æœ‰ç”¨ï½ï½ï½
       //é€»è¾‘--å½“ä¸å­˜åœ¨-æ»‘åŠ¨  å½“å­˜åœ¨ä¸”æ²¡æœ‰ä¸¤ä¸ªå­—-ç»“æŸ
       XCUIElement *cell;
       while ( qure.count > 0) {
           [tableView swipeUp]; //2âƒ£ï¸
           for (int i = 0; i < qure.count; i ++) {
               if (!([qure elementBoundByIndex:i].staticTexts[@"é¢†ä¸»å¯è§"].exists  || [qure elementBoundByIndex:i].staticTexts[@"åˆä¼™äººå¯è§"].exists) && [tableView.cells elementBoundByIndex:i].images[@"icon-order-apply"].exists) {
                   cell = [qure elementBoundByIndex:i];
                   break;//3âƒ£ï¸
               }
           }
           if (cell) {
               break;//4âƒ£ï¸
           }
       }
       [cell tap];
   ```

    âš ï¸   1âƒ£ï¸ åªæœ‰åˆ¤æ–­`containingType` æ²¡æœ‰åé€‰åˆ¤æ–­å…ƒç´ ä¸å­˜åœ¨â€¦â€¦  2âƒ£ï¸ è¿™æ ·ä¼šå…ˆæ»‘åŠ¨ï¼Œå°±ç®—ç¬¬ä¸€ä¸ªå°±æ˜¯ä¹Ÿä¼šæ»‘åŠ¨.... 3âƒ£ï¸ ä¸€ä¸ªbreakåªä¼šå‡ºæ¥ä¸€å±‚å¾ªç¯ï¼Œéœ€è¦4âƒ£ï¸å†å‡ºæ¥ä¸€æ¬¡æ‰èƒ½é€€å‡ºwhile

7. å¾ªç¯ç­‰å¾…ä¸‹ä¸€æ­¥æ“ä½œ -- ä¸æ˜¯æœ€ä¼˜ï¼Œç­‰å¾…ä¼˜åŒ–

    ```objective-c
       while (1) {
              sleep(5);//5såˆ·æ–°ä¸€æ¬¡æ•°æ®,ç­‰å¾…ç”¨æˆ·é€‰ä¸­
              [orderTableView swipeDown];
              if ([app.staticTexts[@"å®¢æˆ·ç”Ÿæˆåè®®ä¸­"] waitForExistenceWithTimeout:3]) {
               break;
              }
          }
    ```

      âš ï¸   è¿™æ ·ä¼š5såˆ·æ–°ä¸€æ¬¡æ•°æ®ï¼Œä½†æ˜¯ä¹Ÿä¼šé€ æˆåœé¡¿æ¯”è¾ƒä¹…ã€‚

8. testæ–¹æ³•å¯ä»¥å¾ªç¯è°ƒç”¨ï¼Œå¼€å¤´ç”¨ifåˆ¤æ–­ï¼Œå°±å¯ä»¥å•ç‹¬ç”¨æˆ–è€…æ•´ä½“è°ƒç”¨ï¼Œä½†æ˜¯è¦æ³¨æ„æœ‰whileçš„

      ```objective-c
        XCUIApplication *app = [[XCUIApplication alloc] init];
          XCUIElement *orderTableView = app.tables[@"zxOrderTable"];
          
          if (!orderTableView.exists) {
              if (!app.buttons[@"å…¨éƒ¨è®¢å•"].exists) {
                  [app.tabBars.buttons[@"æˆ‘çš„å·¥å•"] tap];
              }
              
              XCUIElement *signTable = app.tables[@"BiddenTicketTable"];
              if (!signTable.exists) {
                  [[app.buttons[@"GradientItemActionViewBtn_ä¸­æ ‡è®¢å•"] firstMatch] tap];
              }
              
              
              XCUIElementQuery *qure = signTable.cells;
              
              //ç­‰å¾…æ¥å£åŠ è½½æˆåŠŸ
              XCTAssert([[signTable.cells firstMatch] waitForExistenceWithTimeout:3],@"åˆ—è¡¨å†…å®¹æ˜¾ç¤º");
              
              XCUIElement *cell;
              while (qure.count > 0) {
                  for (int i = 0; i < qure.count; i ++) {
                      XCUIElement *subCell = [qure elementBoundByIndex:i];
                      if (subCell.staticTexts[@"è¢«é€‰ä¸­ï¼Œç­‰å¾…åè®®"].exists ) {
                          cell = [qure elementBoundByIndex:i];
                          break;
                      }
                  }
                  if (cell) {
                      break;
                  }
              }
              [cell tap];
              XCTAssert([app.tables[@"zxOrderTable"] waitForExistenceWithTimeout:3],@"orderå†…å®¹æ˜¾ç¤º");
              
              orderTableView = app.tables[@"zxOrderTable"];
              
          }
      ```

9. isAccessibilityElement   â€œä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºè¯¥é¡¹æ˜¯å¦æ˜¯è¾…åŠ©åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®çš„è¾…åŠ©åŠŸèƒ½å…ƒç´ ã€‚æ­¤å±æ€§çš„é»˜è®¤å€¼ä¸ºfalseã€‚ å¦‚æœæ¥æ”¶å™¨æ˜¯UIKitæ§ä»¶ï¼Œåˆ™é»˜è®¤å€¼ä¸ºtrueã€‚â€  è¿™ä¸ªå±æ€§å€¼ä¸æ˜¯è®¾ç½®è¶Šå¤šè¶Šå¥½ï¼Œå°¤å…¶æ˜¯åµŒå¥—é¡µé¢çš„åœ°æ–¹ã€‚
        [è¿”å›YESï¼Œæ‰€æœ‰å­è§†å›¾çš„å¯è®¿é—®æ€§ä¼šè¢«éšè—ï¼Œä¸å¯è®¿é—®ï¼›è¿”å›NO,åˆ™ç›¸åã€‚](https://www.jianshu.com/p/b039b98ad353)
   
10. uitestsçœŸæœºæŠ¥é”™ï¼Œæ­£å¸¸è¿è¡Œæ²¡æœ‰æŠ¥é”™
```
   Undefined symbols for architecture arm64:
     "_ZIM_SaveImage", referenced from:
         ImgSave(tagIMG, char const*) in libbankcard.a(gjimage.o)
     "_ZIM_LoadImage", referenced from:
         ImgLoad(tagIMG&, char const*) in libbankcard.a(gjimage.o)
     "_ZIM_DoneImage", referenced from:
         ImgLoad(tagIMG&, char const*) in libbankcard.a(gjimage.o)
   ld: symbol(s) not found for architecture arm64
   clang: error: linker command failed with exit code 1 (use -v to see invocation)
```
ä¿®æ”¹ï¼š UITestsçš„Targetæ–‡ä»¶ï¼š
ENABLE_ON_DEMAND_RESOURCES = NO;
ENABLE_TESTABILITY = NO;
MACH_O_TYPE = mh_execute;
SKIP_INSTALL = NO;
STRIP_STYLE = all;
IPHONEOS_DEPLOYMENT_TARGET = 8.0;


å®‰è£…æˆåŠŸ ä½†æ˜¯è¿è¡ŒæŠ¥é”™ï¼š
```
2019-10-09 13:59:28.979079+0800 EngineerUITests-Runner[4122:947621] Running tests...
2019-10-09 13:59:29.017788+0800 EngineerUITests-Runner[4122:947621] æœªèƒ½è½½å…¥è½¯ä»¶åŒ…â€œEngineerUITestsâ€ï¼Œå› ä¸ºå…¶å¯æ‰§è¡Œæ–‡ä»¶ä¸å¯è½½å…¥ã€‚ è¯·å°è¯•é‡æ–°å®‰è£…è½¯ä»¶åŒ…ã€‚
```

ä¿®æ”¹
ENABLE_TESTABILITY = NO;
æŠ¥é”™ï¼š _ZIM_SaveImage

ä¿®æ”¹
ENABLE_ON_DEMAND_RESOURCES = yesï¼›
æŠ¥é”™ï¼šOn-Demand Resources is enabled (ENABLE_ON_DEMAND_RESOURCES = YES), but is not supported for ui testing bundle targets

ä¿®æ”¹
MACH_O_TYPE = bundle;
æŠ¥é”™ï¼š _ZIM_SaveImage

MACH_O_TYPE:è®¾ç½®å¯æ‰§è¡Œæ–‡ä»¶ç¼–è¯‘ç±»å‹ï¼Œ

```
é™„ï¼šbankCardæ·»åŠ 
1.åŒ…  IDAndBankCard
https://github.com/mxl123/IDAndBankCard

2.ä¿®æ”¹é…ç½®  
enable  bitCode no
enable testability no

3.æ¨¡æ‹Ÿå™¨ç¼–è¯‘é”™è¯¯ 
æ¨¡æ‹Ÿå™¨ä¸Šç¼–è¯‘æŠ¥é”™ï¼ŒçœŸæœºä¸Šæ­£å¸¸
ld: warning: ignoring file /Users/wuliuyan/Desktop/ç¥å·é‚¦é‚¦-ä»£ç /gcs-ios/Engineer/Vendors/BankCardScan/bank_io/exbankcardcore/libbankcard.a, missing required architecture x86_64 in file /Users/wuliuyan/Desktop/ç¥å·é‚¦é‚¦-ä»£ç /gcs-ios/Engineer/Vendors/BankCardScan/bank_io/exbankcardcore/libbankcard.a (3 slices)
Undefined symbols for architecture x86_64:
  "_BankCardNV12", referenced from:
      -[XLScanManagerControl parseBankImageBuffer:] in XLScanManagerControl.o
ld: symbol(s) not found for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see invocation)


é”™è¯¯åŸå› ï¼š_BankCardNV12 åœ¨æ¨¡æ‹Ÿå™¨ä¸Šä¸èƒ½ç”¨
è§£å†³åŠæ³•ï¼šåœ¨ä½¿ç”¨å®ƒçš„é‚£ä¸€æ®µåŠ ä¸Š
 \#if !TARGET_IPHONE_SIMULATOR
\#endif

[#ifè¯­å¥ä½¿ç”¨](https://www.cnblogs.com/Black-R/p/5596050.html)
```

ã€‚ã€‚ã€‚ã€‚
è°ç»™æˆ‘è¯´è¦åœ¨æµ‹è¯•æ–‡ä»¶çš„targetsæ–‡ä»¶é‡Œé¢çš„compile Source å’Œ copy bundle resources ä»€ä¹ˆçš„é‡Œé¢æ·»åŠ å’Œå·¥ç¨‹ä¸€æ ·çš„æ–‡ä»¶çš„â€¦â€¦
æˆ‘æŠŠå®ƒéƒ½åˆ äº† åªç•™ compile Sourceé‡Œé¢çš„uitests.mçš„æ–‡ä»¶  ç„¶åâ€¦â€¦å¯ä»¥è¿è¡Œçš„â€¦â€¦å¹¶ä¸”æˆåŠŸæµ‹è¯•äº†çš„â€¦â€¦
å¦ˆè€¶ æˆ‘åœ¨å“ªé‡Œå¬åˆ°çš„è°£è¨€â€¦â€¦å˜¤å˜¤å˜¤


11. æŒ‰é’®å¯¼èˆªæ æ‰¾ä¸åˆ°æŒ‰é’®ï¼Œå°¤å…¶æ˜¯å…ˆè®¾ç½®äº†   
`self.navigationItem.rightBarButtonItem = nil; ` 
ç½‘ç»œè¯·æ±‚å®Œæˆä¹‹åå†è®¾ç½®
` [self setRightBlackBarItemWithTitle:@"å¢åŠ "]; ` 
å°±æ‰¾ä¸åˆ°æŒ‰é’®ï¼Œä¿®æ”¹-æ·»åŠ                  
`dispatch_async(dispatch_get_main_queue(), ^{});`
æŠŠè®¾ç½®æ”¾åˆ°ä¸»æµç¨‹ä¸­ã€‚ä½¿ç”¨ ` #define dispatch_main_sync(block)` ä¸è¡Œ



-----

#### iOS13 

å¤œé—´æ¨¡å¼ï¼š
è¦é€‚é…çš„è¯åœ¨è®¾ç½®ä¸€ä¸ªimageSet,è®¾ç½®defineé¢œè‰²ä¿®æ”¹æ—¶æ·»åŠ ä¸¤ç§ã€‚ é»˜è®¤çš„ç™½è‰²ä¼šè‡ªå·±å˜ï¼Œtabbarä¸Šä¼šå˜æˆé»‘è‰²çš„ã€‚statusbarä¹Ÿä¼šè‡ªå·±å˜ã€‚
ä¸é€‚é…çš„è¯  åœ¨ `info.plist` é‡Œé¢æ·»åŠ   `User Interface Style = ï¼ˆstringï¼‰Light`,å•ä¸ªé¡µé¢è®¾ç½®å¯ä»¥æ·»åŠ   `self.overrideUserInterfaceStyle = UIUserInterfaceStyleLight;` 

å¼¹å‡ºé¡µé¢æ ·å¼ï¼š
`presentViewController:animated:completion:`  æ¨å‡ºé¡µé¢ï¼Œæ¨å‡ºçš„é¡µé¢  `modalPresentationStyle` å±æ€§ ä¹‹å‰é»˜è®¤å€¼æ˜¯ `UIModalPresentationFullScreen = 0`,iOS13å†…æœ«æ—¥æ”¹ä¸º  `UIModalPresentationAutomatic API_AVAILABLE(ios(13.0)) = -2,`    é¡µé¢æ˜¾ç¤ºä¸ºå±‚å çš„ï¼Œé¡µé¢æ¶ˆå¤±æ—¶,å‰ä¸€ä¸ªé¡µé¢ä¸èµ° `viewWillAppear`. ä¿®æ”¹å¯ä»¥ç»™é¡µé¢è®¾ç½® `self.modalPresentationStyle = UIModalPresentationFullScreen;`

é«˜å¾·åœ°å›¾éœ€è¦æ›´æ–°ï¼Œé€†åœ°å€ç¼–ç ä¸èµ°å›æ‰
ä¿¡é¸½éœ€è¦æ›´æ–°ï¼Œxcode11æ‰“åŒ…çš„æ”¶ä¸åˆ°æ¨é€
`- (void)tableView:(UITableView *)tableView willDisplayFooterView:(UIView *)view forSection:(NSInteger)section`é‡Œé¢ä¸èƒ½å–  `tableView:cellForRowAtIndexPath:` äº†ï¼Œè¯´é¡µé¢æ²¡æœ‰æ›´æ–°å®Œçš„æ—¶å€™ä¸èƒ½è°ƒç”¨ï¼Œåœ¨ä¹‹å‰ä¸ä¼šæç¤ºï¼Œå–é«˜åº¦æ”¹ä¸º `view` çš„ `frame`ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œå·²ç»æœ‰ `frame`äº†.



----
#### storeBord
2020.4åœæ­¢ä½¿ç”¨`LaungingImage`,æ‰€æœ‰çš„éƒ½éœ€è¦`LaungingScreen.storeBord`.
ç”¨`LaungingScreen.xib`ä¼šé‡åˆ°æ¢ä¸äº†å›¾ç‰‡çš„é—®é¢˜ï¼Œ`storeBord`å¥½ä¸€ç‚¹ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šæœ‰é—®é¢˜ã€‚
ç”¨`storeBord`,éœ€è¦åœ¨è®¾ç½®é‡Œé¢è®¾ç½®åœ°å€ `LaungingScreenFile` ï¼Œä¹‹åå¯ä»¥æ‹¼æ¥å›¾ç‰‡ã€‚
å¦‚æœéœ€è¦æ›´æ¢å›¾ç‰‡ï¼Œç”¨åŸæ¥çš„imageViewä¼šä¸æ˜¾ç¤ºï¼Œéœ€è¦åˆ äº†ï¼Œé‡æ–°æ·»åŠ ã€‚



#### iOS13çš„å‘
textView å¯Œæ–‡æœ¬  å¸¦å›¾ç‰‡ å›¾ç‰‡æœ‰ç‚¹å‡»äº‹ä»¶  
è€Œä¸”åªæœ‰ 13.0  ä¹‹åçš„å°±ä¿®å¤äº†  qswl
æ·»åŠ äº†è¿™ä¸ªæ–¹æ³•
```

- (BOOL)textView:(UITextView *)textView shouldInteractWithTextAttachment:(NSTextAttachment *)textAttachment inRange:(NSRange)characterRange interaction:(UITextItemInteraction)interaction {
    if ([[UIDevice currentDevice].systemVersion isEqualToString: @"13.0"]  && self.couldEdit) {
        [textView becomeFirstResponder];
    }
    return NO;
}

```

#### xcode11 Main.storyBord
xcode11é»˜è®¤åˆ›å»ºæ–‡ä»¶é‡‡ç”¨äº†Scenedelegate.h ï¼Œå…³äºé¡µé¢çš„ç›¸å…³å†…å®¹åœ¨Scenedelegate.mé‡Œé¢è®¾ç½®
ä½†æ˜¯æœ‰æ—¶ä¼šæ¨ä¸å‡ºæ¥windowsï¼Œæ¯”å¦‚è…¾è®¯çš„äººè„¸è¯†åˆ«çš„
ç„¶åå°±è¦ä¸ç”¨storyBord,ä½†æ˜¯è·Ÿä¹‹å‰ä¸€æ ·ç›´æ¥åˆ äº†ï¼Œæ‰“å¼€å°±é»‘å±
è§£å†³æ˜¯  æŠŠappdelegateé‡Œé¢çš„ UISceneSession lifecycle æ³¨é‡Šæ‰
å…¨éƒ¨çš„æ–¹æ³•ï¼š1. åˆ   åˆ é™¤Scenedelegateï¼Œ  åˆ é™¤ targeté‡Œé¢çš„mainInterface ï¼Œåˆ é™¤Main.storyBord,åˆ  info.plist é‡Œé¢çš„Application Scene Manifest é‡Œé¢çš„main   2. æ”¹ æ³¨é‡Šæ‰appdelegateé‡Œé¢çš„ UISceneSession lifecycle 3.åœ¨appdelegateé‡Œé¢åŠ ä¸ŠåŸæ¥çš„è®¾ç½®mainwindowçš„æ–¹æ³•
å¦‚æœä¸åˆ Scenedelegate  åªæ˜¯æ¢mainViewçš„è¯ï¼Œéƒ½ä¸åˆ ï¼Œåœ¨Scenedelegateé‡Œé¢è®¾ç½®windowsçš„ç›¸å…³æ–¹æ³•å°±è¡Œ



#### xcode11.2  textViewç”¨xibåˆ›å»ºçš„å´©æºƒ

XCodeå‡çº§åˆ°11.2ï¼Œå‘ç°åŸæ¥ç”¨åˆ°XIBçš„å­ç±»ä»£ç ç•Œé¢ä¼šåœ¨IOS12æœºå‹é—ªé€€.

é”™è¯¯åŸå› ï¼š

> Could not instantiate class named _UITextLayoutView because no class named _UITextLayoutView was found; the class needs to be defined in source code or linked in from a library (ensure the class is part of the correct target)

å»ºè®®1æ˜¯æ‰‹å†™ä»£ç é¿å‘ï¼›2æ˜¯ä¸‹è½½è€ç‰ˆæœ¬çš„Xcodeã€‚

ç¡¬æ‰“è¡¥ä¸

```objective-c
.h
#import <Foundation/Foundation.h>
 
NS_ASSUME_NONNULL_BEGIN
 
@interface UITextViewWorkaround : NSObject
+ (void)executeWorkaround;
@end
 
NS_ASSUME_NONNULL_END
  
 .m
  #import "UITextViewWorkaround.h"
#import <objc/runtime.h>
 
@implementation UITextViewWorkaround
 
+ (void)executeWorkaround {
    if (@available(iOS 13.2, *)) {
 
    }
    else {
        const char *className = "_UITextLayoutView";
        Class cls = objc_getClass(className);
        if (cls == nil) {
            cls = objc_allocateClassPair([UIView class], className, 0);
            objc_registerClassPair(cls);
#if DEBUG
            printf("added %s dynamically\n", className);
#endif
        }
    }
}
 
@end

Appdelegate.m
  
........
 
#import "UITextViewWorkaround.h"
 
@implementation AppDelegate
 
 
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
 
......
 
//è§£å†³Xcode ä¸èƒ½è¯»å–textView xib å´©æºƒ
    [UITextViewWorkaround executeWorkaround];
    return YES;
}
```

